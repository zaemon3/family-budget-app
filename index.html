<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
        }
        
        .nav-tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            padding: 25px;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            opacity: 0.1;
            font-size: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .income-card {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #2d5016;
        }
        
        .expense-card {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #8b0000;
        }
        
        .balance-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #2c3e50;
        }
        
        .card h3 {
            font-size: 1.1em;
            margin-bottom: 10px;
            opacity: 0.8;
        }
        
        .card .amount {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .card .trend {
            font-size: 24px;
            float: right;
            margin-top: -40px;
        }
        
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .form-section h3 {
            margin-bottom: 20px;
            color: #495057;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
        }
        
        .transactions-list {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .transaction-item {
            padding: 20px;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            justify-content: between;
            align-items: center;
            transition: background-color 0.3s ease;
        }
        
        .transaction-item:hover {
            background: #f8f9fa;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info {
            flex: 1;
        }
        
        .transaction-description {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .transaction-meta {
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .transaction-amount {
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .transaction-amount.income {
            color: #28a745;
        }
        
        .transaction-amount.expense {
            color: #dc3545;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 15px;
            font-size: 12px;
            transition: background-color 0.3s ease;
        }
        
        .delete-btn:hover {
            background: #c82333;
        }
        
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .chart-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #495057;
            text-align: center;
        }
        
        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-style: italic;
        }
        
        .export-section {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .nav-tab {
                padding: 15px 10px;
                font-size: 14px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .form-row, .filter-row {
                grid-template-columns: 1fr;
            }
            
            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .export-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒª</h1>
            <p>æ¯æ—¥ã®åæ”¯ã‚’ç°¡å˜ã«ç®¡ç†ã—ã¾ã—ã‚‡ã†</p>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('dashboard')">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
            <div class="nav-tab" onclick="switchTab('monthly')">æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿</div>
            <div class="nav-tab" onclick="switchTab('yearly')">å¹´åˆ¥ãƒ‡ãƒ¼ã‚¿</div>
            <div class="nav-tab" onclick="switchTab('analysis')">æ”¯å‡ºåˆ†æ</div>
            <div class="nav-tab" onclick="switchTab('backup')">å…±æœ‰ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</div>
        </div>
        
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-cards">
                <div class="card income-card">
                    <h3>ç·åå…¥</h3>
                    <div class="amount" id="totalIncome">Â¥0</div>
                    <div class="trend">ğŸ“ˆ</div>
                </div>
                <div class="card expense-card">
                    <h3>ç·æ”¯å‡º</h3>
                    <div class="amount" id="totalExpense">Â¥0</div>
                    <div class="trend">ğŸ“‰</div>
                </div>
                <div class="card balance-card">
                    <h3>æ®‹é«˜</h3>
                    <div class="amount" id="balance">Â¥0</div>
                    <div class="trend">ğŸ’°</div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>æ–°ã—ã„å–å¼•ã‚’è¿½åŠ </h3>
                <form id="transactionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="description">èª¬æ˜</label>
                            <input type="text" id="description" required placeholder="ä¾‹ï¼šé£Ÿè²»ã€çµ¦æ–™ãªã©">
                        </div>
                        <div class="form-group">
                            <label for="amount">é‡‘é¡</label>
                            <input type="number" id="amount" required placeholder="é‡‘é¡ã‚’å…¥åŠ›">
                        </div>
                        <div class="form-group">
                            <label for="type">ç¨®é¡</label>
                            <select id="type" required>
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="income">åå…¥</option>
                                <option value="expense">æ”¯å‡º</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="category">ã‚«ãƒ†ã‚´ãƒª <span id="typeIndicator" style="font-size: 14px; margin-left: 10px;"></span></label>
                            <select id="category" required onchange="updateCategoryType()">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <optgroup label="åå…¥">
                                    <option value="çµ¦æ–™">çµ¦æ–™</option>
                                    <option value="å‰¯åå…¥">å‰¯åå…¥</option>
                                    <option value="ãƒœãƒ¼ãƒŠã‚¹">ãƒœãƒ¼ãƒŠã‚¹</option>
                                </optgroup>
                                <optgroup label="æ”¯å‡º">
                                    <option value="é£Ÿè²»">é£Ÿè²»</option>
                                    <option value="äº¤é€šè²»">äº¤é€šè²»</option>
                                    <option value="å¨¯æ¥½">å¨¯æ¥½</option>
                                    <option value="å…‰ç†±è²»">å…‰ç†±è²»</option>
                                    <option value="å®¶è³ƒ">å®¶è³ƒ</option>
                                    <option value="é€šä¿¡è²»">é€šä¿¡è²»</option>
                                    <option value="åŒ»ç™‚è²»">åŒ»ç™‚è²»</option>
                                    <option value="æ—¥ç”¨å“">æ—¥ç”¨å“</option>
                                    <option value="ãã®ä»–">ãã®ä»–</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="date">æ—¥ä»˜</label>
                            <input type="date" id="date" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">è¿½åŠ </button>
                </form>
            </div>
            
            <div class="transactions-list">
                <h3 style="padding: 20px; margin: 0; background: #f8f9fa; border-bottom: 1px solid #e9ecef;">ä»Šæ—¥ã®å–å¼•</h3>
                <div id="transactionsList"></div>
            </div>
        </div>
        
        <div id="monthly" class="tab-content">
            <div class="filter-section">
                <h3>æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</h3>
                <div class="filter-row">
                    <div class="form-group">
                        <label for="yearSelectMonthly">å¹´:</label>
                        <select id="yearSelectMonthly" onchange="updateSelectedMonth()">
                            <option value="2025">2025å¹´</option>
                            <option value="2024">2024å¹´</option>
                            <option value="2023">2023å¹´</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="monthSelectMonthly">æœˆ:</label>
                        <select id="monthSelectMonthly" onchange="updateSelectedMonth()">
                            <option value="01">1æœˆ</option>
                            <option value="02">2æœˆ</option>
                            <option value="03">3æœˆ</option>
                            <option value="04">4æœˆ</option>
                            <option value="05">5æœˆ</option>
                            <option value="06">6æœˆ</option>
                            <option value="07">7æœˆ</option>
                            <option value="08">8æœˆ</option>
                            <option value="09">9æœˆ</option>
                            <option value="10">10æœˆ</option>
                            <option value="11">11æœˆ</option>
                            <option value="12">12æœˆ</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">æœˆåˆ¥åæ”¯ã‚°ãƒ©ãƒ•</div>
                <canvas id="monthlyChart" width="400" height="200"></canvas>
            </div>
            
            <div id="monthlyData"></div>
        </div>
        
        <div id="yearly" class="tab-content">
            <div class="filter-section">
                <h3>å¹´åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h3>
                <div class="filter-row">
                    <div class="form-group">
                        <label for="yearFilter">å¹´ã‚’é¸æŠ</label>
                        <select id="yearFilter"></select>
                    </div>
                    <button class="btn btn-primary" onclick="filterByYear()">è¡¨ç¤º</button>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">å¹´åˆ¥åæ”¯ã‚°ãƒ©ãƒ•</div>
                <canvas id="yearlyChart" width="400" height="200"></canvas>
            </div>
            
            <div id="yearlyData"></div>
        </div>
        
        <div id="analysis" class="tab-content">
            <div class="chart-container">
                <div class="chart-title">æ”¯å‡ºã‚«ãƒ†ã‚´ãƒªåˆ¥åˆ†æ</div>
                <canvas id="categoryChart" width="400" height="400"></canvas>
            </div>
            
            <div id="categoryAnalysis"></div>
            
            <div class="export-section">
                <h3>ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†</h3>
                <p>ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ãŸã‚Šã€ä»–ã®å½¢å¼ã§ä¿å­˜ã§ãã¾ã™ã€‚</p>
                <div class="export-buttons">
                    <button class="btn btn-success" onclick="exportToJSON()">JSONã§ä¿å­˜</button>
                    <button class="btn btn-success" onclick="exportToCSV()">CSVã§ä¿å­˜</button>
                    <input type="file" id="importFile" accept=".json,.csv" style="display: none;" onchange="importData()">
                    <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ</button>
                    <button class="btn btn-danger" onclick="clearAllData()">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
                </div>
            </div>
        </div>
        
        <div id="backup" class="tab-content">
            <div class="form-section">
                <h2 class="chart-title">ğŸ”— ãƒ‡ãƒ¼ã‚¿ã®å…±æœ‰ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h2>
                
                <!-- ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
                <div style="margin-bottom: 30px;">
                    <h3>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h3>
                    
                    <!-- æœŸé–“é¸æŠ -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #e9ecef;">
                        <h4 style="margin-bottom: 15px; color: #495057;">ä¿å­˜æœŸé–“ã‚’é¸æŠ</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="exportPeriod" value="all" checked onchange="setExportPeriod(this.value)">
                                <span style="font-size: 14px;">å…¨æœŸé–“</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="exportPeriod" value="current-month" onchange="setExportPeriod(this.value)">
                                <span style="font-size: 14px;">ä»Šæœˆ</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="exportPeriod" value="current-year" onchange="setExportPeriod(this.value)">
                                <span style="font-size: 14px;">ä»Šå¹´</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="exportPeriod" value="custom" onchange="setExportPeriod(this.value)">
                                <span style="font-size: 14px;">æœŸé–“æŒ‡å®š</span>
                            </label>
                        </div>
                        
                        <!-- ã‚«ã‚¹ã‚¿ãƒ æœŸé–“è¨­å®š -->
                        <div id="customPeriodSettings" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 5px; color: #495057;">é–‹å§‹æ—¥</label>
                                    <input type="date" id="exportStartDate" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 5px;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 5px; color: #495057;">çµ‚äº†æ—¥</label>
                                    <input type="date" id="exportEndDate" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 5px;">
                                </div>
                            </div>
                        </div>
                        
                        <!-- é¸æŠã•ã‚ŒãŸæœŸé–“ã®æƒ…å ±è¡¨ç¤º -->
                        <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border: 1px solid #bbdefb; border-radius: 5px;">
                            <p style="font-size: 14px; color: #1976d2; margin: 0;">
                                ğŸ“Š å¯¾è±¡ä»¶æ•°: <strong id="exportTargetCount">0ä»¶</strong>
                                <span id="exportPeriodInfo"></span>
                            </p>
                        </div>
                    </div>
                    
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #bbdefb;">
                        <p style="font-size: 14px; color: #1976d2; margin: 0;">
                            å®¶è¨ˆç°¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ãŸã‚Šã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦ä¿å­˜ã§ãã¾ã™ã€‚
                        </p>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="exportFilteredJSON()">JSONã§ä¿å­˜</button>
                        <button class="btn btn-success" onclick="exportFilteredCSV()">CSVã§ä¿å­˜</button>
                    </div>
                    <div style="font-size: 12px; color: #6c757d;">
                        <p><strong>JSON:</strong> å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆæ¨å¥¨ï¼‰</p>
                        <p><strong>CSV:</strong> Excelãƒ»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§é–‹ã‘ã‚‹å½¢å¼</p>
                    </div>
                </div>

                <!-- ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ -->
                <div style="margin-bottom: 30px;">
                    <h3>ğŸ“‚ ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒ</h3>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #ffeaa7;">
                        <p style="font-size: 14px; color: #856404; margin: 0; margin-bottom: 8px;">
                            âš ï¸ æ³¨æ„: ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã™ã‚‹ã¨ã€ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦äº‹å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã£ã¦ãã ã•ã„ã€‚
                        </p>
                        <p style="font-size: 14px; color: #856404; margin: 0;">
                            ğŸ“„ å¯¾å¿œå½¢å¼: JSONã€CSVï¼ˆExcelç­‰ã§ç·¨é›†å¯èƒ½ï¼‰
                        </p>
                    </div>
                    <button class="btn btn-success" onclick="document.getElementById('importFile').click()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦å¾©å…ƒ</button>
                </div>

                <!-- URLå…±æœ‰ -->
                <div style="margin-bottom: 30px;">
                    <h3>ğŸ”— URLã§å…±æœ‰</h3>
                    <div style="background: #d4edda; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #c3e6cb;">
                        <p style="font-size: 14px; color: #155724; margin: 0;">
                            ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€URLã‚’ç”Ÿæˆã—ã¦ã€å®¶æ—ã‚„ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã¨å…±æœ‰ã§ãã¾ã™ã€‚URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã ã‘ã§ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
                        </p>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="generateShareUrl()">å…±æœ‰URLã‚’ç”Ÿæˆ</button>
                        <button class="btn btn-primary" id="copyUrlBtn" onclick="copyShareUrl()" style="display: none;">URLã‚’ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    
                    <div id="shareUrlContainer" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <p style="font-size: 14px; color: #6c757d; margin-bottom: 8px;">ç”Ÿæˆã•ã‚ŒãŸå…±æœ‰URL:</p>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="shareUrlInput" readonly style="flex: 1; padding: 8px; border: 1px solid #ced4da; border-radius: 5px; background: white; font-size: 12px;">
                        </div>
                    </div>
                    
                    <div id="copyMessage" style="display: none; margin-top: 10px; padding: 8px; background: #d4edda; color: #155724; border-radius: 5px; font-size: 14px;">
                        âœ… URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
                    </div>
                </div>

                <!-- ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ -->
                <div style="margin-bottom: 30px;">
                    <h3>ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤</h3>
                    <div style="background: #f8d7da; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #f5c6cb;">
                        <p style="font-size: 14px; color: #721c24; margin: 0;">
                            âš ï¸ è­¦å‘Š: ã“ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã™ã¹ã¦ã®å–å¼•ãƒ‡ãƒ¼ã‚¿ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚
                        </p>
                    </div>
                    <button class="btn btn-danger" onclick="clearAllData()">ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</button>
                </div>

                <!-- ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3>ğŸ“– ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h3>
                    <div style="font-size: 14px; color: #6c757d; line-height: 1.6;">
                        <div style="margin-bottom: 15px;">
                            <h4 style="font-weight: 600; color: #495057; margin-bottom: 5px;">ğŸ’¾ è‡ªå‹•ä¿å­˜æ©Ÿèƒ½</h4>
                            <p style="margin: 0;">ãƒ‡ãƒ¼ã‚¿ã¯å…¥åŠ›ã¨åŒæ™‚ã«è‡ªå‹•çš„ã«ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ã€å†åº¦é–‹ãã¨ãã«ãƒ‡ãƒ¼ã‚¿ãŒå¾©å…ƒã•ã‚Œã¾ã™ã€‚</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <h4 style="font-weight: 600; color: #495057; margin-bottom: 5px;">ğŸ  å®¶æ—é–“ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰</h4>
                            <p style="margin: 0;">1. ã€Œå…±æœ‰URLã‚’ç”Ÿæˆã€ã§URLã‚’ä½œæˆ<br>2. ã€ŒURLã‚’ã‚³ãƒ”ãƒ¼ã€ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼<br>3. å®¶æ—ã«URLã‚’é€ä¿¡ï¼ˆLINEã€ãƒ¡ãƒ¼ãƒ«ãªã©ï¼‰<br>4. å—ã‘å–ã£ãŸäººãŒURLã«ã‚¢ã‚¯ã‚»ã‚¹</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <h4 style="font-weight: 600; color: #495057; margin-bottom: 5px;">ğŸ“Š CSVãƒ•ã‚¡ã‚¤ãƒ«ã§ã®æ´»ç”¨</h4>
                            <p style="margin: 0;">1. ã€ŒCSVã§ä¿å­˜ã€ã§ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰<br>2. Excelãƒ»Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§é–‹ã„ã¦ç·¨é›†<br>3. ç·¨é›†å¾Œã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦å¾©å…ƒã€ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ<br>4. ã‚°ãƒ©ãƒ•ä½œæˆã‚„è©³ç´°åˆ†æã«æ´»ç”¨</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <h4 style="font-weight: 600; color: #495057; margin-bottom: 5px;">ğŸ“± ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã®åˆ©ç”¨</h4>
                            <p style="margin: 0;">1. ã€ŒJSONã§ä¿å­˜ã€ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜<br>2. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã«è»¢é€ï¼ˆãƒ¡ãƒ¼ãƒ«æ·»ä»˜ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãªã©ï¼‰<br>3. ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦å¾©å…ƒã€</p>
                        </div>
                        <div>
                            <h4 style="font-weight: 600; color: #495057; margin-bottom: 5px;">ğŸ’¾ å®šæœŸçš„ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h4>
                            <p style="margin: 0;">æœˆæœ«ãªã©ã«å®šæœŸçš„ã«ã€ŒJSONã§ä¿å­˜ã€ã‚’å®Ÿè¡Œã—ã¦ã€é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã«ä¿ç®¡ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        
        // åˆæœŸåŒ–
        document.getElementById('date').valueAsDate = new Date();
        
        // æœˆåˆ¥ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®åˆæœŸåŒ–
        function initializeMonthSelectors() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');
            
            // å¹´é¸æŠã®åˆæœŸåŒ–
            const yearSelect = document.getElementById('yearSelectMonthly');
            if (yearSelect) {
                yearSelect.value = currentYear;
            }
            
            // æœˆé¸æŠã®åˆæœŸåŒ–
            const monthSelect = document.getElementById('monthSelectMonthly');
            if (monthSelect) {
                monthSelect.value = currentMonth;
            }
            
            // selectedMonthã‚’æ›´æ–°
            selectedMonth = `${currentYear}-${currentMonth}`;
        }
        
        function updateSelectedMonth() {
            const yearSelect = document.getElementById('yearSelectMonthly');
            const monthSelect = document.getElementById('monthSelectMonthly');
            
            if (yearSelect && monthSelect) {
                selectedMonth = `${yearSelect.value}-${monthSelect.value}`;
                
                // æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                if (document.getElementById('monthly').classList.contains('active')) {
                    updateMonthlyDisplay();
                }
            }
        }
        
        function updateMonthlyDisplay() {
            const currentMonthData = getMonthlyData(selectedMonth);
            
            // æœˆåˆ¥ã‚µãƒãƒªãƒ¼ã‚’æ›´æ–°
            const monthlyIncome = currentMonthData
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const monthlyExpense = currentMonthData
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            // ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°ï¼ˆæœˆåˆ¥ã‚¿ãƒ–å†…ã®è¦ç´ ã‚’æ›´æ–°ï¼‰
            const monthlyCards = document.querySelector('#monthly .dashboard-cards');
            if (monthlyCards) {
                monthlyCards.innerHTML = `
                    <div class="card income-card">
                        <h3>æœˆé–“åå…¥</h3>
                        <div class="amount">Â¥${monthlyIncome.toLocaleString()}</div>
                        <div class="trend">ğŸ“ˆ</div>
                    </div>
                    <div class="card expense-card">
                        <h3>æœˆé–“æ”¯å‡º</h3>
                        <div class="amount">Â¥${monthlyExpense.toLocaleString()}</div>
                        <div class="trend">ğŸ“‰</div>
                    </div>
                    <div class="card balance-card">
                        <h3>æœˆé–“åæ”¯</h3>
                        <div class="amount">Â¥${(monthlyIncome - monthlyExpense).toLocaleString()}</div>
                        <div class="trend">ğŸ’°</div>
                    </div>
                `;
            }
            
            // å–å¼•ä¸€è¦§ã‚’æ›´æ–°
            updateMonthlyTransactionsList(currentMonthData);
        }
        
        function updateMonthlyTransactionsList(monthData) {
            const listContainer = document.querySelector('#monthly .transactions-list div:last-child');
            if (!listContainer) return;
            
            if (monthData.length === 0) {
                listContainer.innerHTML = '<div class="no-data">ã“ã®æœˆã¯å–å¼•ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            listContainer.innerHTML = monthData
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(transaction => `
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-description">${transaction.description}</div>
                            <div class="transaction-meta">${transaction.category} â€¢ ${new Date(transaction.date).toLocaleDateString('ja-JP')}</div>
                        </div>
                        <div class="transaction-amount ${transaction.type}">
                            ${transaction.type === 'income' ? '+' : '-'}Â¥${transaction.amount.toLocaleString()}
                        </div>
                        <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">å‰Šé™¤</button>
                    </div>
                `).join('');
        }
        
        initializeApp();
        initializeMonthSelectors();
        
        function initializeApp() {
            updateDashboard();
            updateTransactionsList();
            setupYearFilter();
            renderCharts();
        }
        
        function switchTab(tabName) {
            // ã‚¿ãƒ–ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // ã‚¿ãƒ–ãŒåˆ‡ã‚Šæ›¿ã‚ã£ãŸã¨ãã«ãƒãƒ£ãƒ¼ãƒˆã‚’å†æç”»
            setTimeout(() => {
                renderCharts();
            }, 100);
        }
        
        function addTransaction(event) {
            event.preventDefault();
            
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;
            const date = document.getElementById('date').value;
            
            const transaction = {
                id: Date.now(),
                description,
                amount,
                type,
                category,
                date,
                timestamp: new Date().toISOString()
            };
            
            transactions.push(transaction);
            saveTransactions();
            updateDashboard();
            updateTransactionsList();
            renderCharts();
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('transactionForm').reset();
            document.getElementById('date').valueAsDate = new Date();
        }
        
        function deleteTransaction(id) {
            if (confirm('ã“ã®å–å¼•ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                transactions = transactions.filter(t => t.id !== id);
                saveTransactions();
                updateDashboard();
                updateTransactionsList();
                renderCharts();
            }
        }
        
        function updateDashboard() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const balance = totalIncome - totalExpense;
            
            document.getElementById('totalIncome').textContent = `Â¥${totalIncome.toLocaleString()}`;
            document.getElementById('totalExpense').textContent = `Â¥${totalExpense.toLocaleString()}`;
            document.getElementById('balance').textContent = `Â¥${balance.toLocaleString()}`;
        }
        
        let currentFilter = 'all';
        
        function setFilter(filterType) {
            currentFilter = filterType;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
            const allBtn = document.getElementById('filterAll');
            const incomeBtn = document.getElementById('filterIncome');
            const expenseBtn = document.getElementById('filterExpense');
            
            // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
            [allBtn, incomeBtn, expenseBtn].forEach(btn => {
                if (btn) {
                    btn.className = 'px-4 py-2 rounded-lg font-medium transition-colors bg-white text-gray-700 hover:bg-gray-100';
                }
            });
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒœã‚¿ãƒ³ã‚’è¨­å®š
            if (filterType === 'all' && allBtn) {
                allBtn.className = 'px-4 py-2 rounded-lg font-medium transition-colors bg-blue-500 text-white';
            } else if (filterType === 'income' && incomeBtn) {
                incomeBtn.className = 'px-4 py-2 rounded-lg font-medium transition-colors bg-green-500 text-white';
            } else if (filterType === 'expense' && expenseBtn) {
                expenseBtn.className = 'px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 text-white';
            }
            
            // å–å¼•ãƒªã‚¹ãƒˆã‚’æ›´æ–°
            updateFilteredTransactionsList();
        }
        
        // å½“æ—¥ã®å–å¼•ã®ã¿ã‚’å–å¾—ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ï¼‰
        function getTodaysTransactions() {
            // ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ—¥æœ¬æ™‚é–“ã§å–å¾—
            const today = new Date();
            const todayString = today.getFullYear() + '-' + 
                               String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                               String(today.getDate()).padStart(2, '0');
            
            return transactions.filter(t => t.date === todayString);
        }
        
        function updateTransactionsList() {
            updateFilteredTransactionsList();
        }sList');
            let todaysTransactions = getTodaysTransactions();
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨
            if (currentFilter === 'income') {
                todaysTransactions = todaysTransactions.filter(t => t.type === 'income');
            } else if (currentFilter === 'expense') {
                todaysTransactions = todaysTransactions.filter(t => t.type === 'expense');
            }
            
            if (todaysTransactions.length === 0) {
                let message = 'ä»Šæ—¥ã¯ã¾ã å–å¼•ãŒã‚ã‚Šã¾ã›ã‚“';
                if (currentFilter === 'income') {
                    message = 'ä»Šæ—¥ã¯ã¾ã åå…¥ã®å–å¼•ãŒã‚ã‚Šã¾ã›ã‚“';
                } else if (currentFilter === 'expense') {
                    message = 'ä»Šæ—¥ã¯ã¾ã æ”¯å‡ºã®å–å¼•ãŒã‚ã‚Šã¾ã›ã‚“';
                }
                listElement.innerHTML = `<div class="no-data">${message}</div>`;
                return;
            }
            
            const sortedTransactions = [...todaysTransactions].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            listElement.innerHTML = sortedTransactions
                .map(transaction => `
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-description">${transaction.description}</div>
                            <div class="transaction-meta">${transaction.category} â€¢ ${new Date(transaction.date).toLocaleDateString('ja-JP')}</div>
                        </div>
                        <div class="transaction-amount ${transaction.type}">
                            ${transaction.type === 'income' ? '+' : '-'}Â¥${transaction.amount.toLocaleString()}
                        </div>
                        <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">å‰Šé™¤</button>
                    </div>
                `).join('');
        }
        
        function setupYearFilter() {
            const yearSelect = document.getElementById('yearFilter');
            const currentYear = new Date().getFullYear();
            const years = new Set();
            
            transactions.forEach(t => {
                years.add(new Date(t.date).getFullYear());
            });
            
            if (years.size === 0) {
                years.add(currentYear);
            }
            
            yearSelect.innerHTML = Array.from(years)
                .sort((a, b) => b - a)
                .map(year => `<option value="${year}">${year}å¹´</option>`)
                .join('');
        }
        
        function filterByMonth() {
            const monthFilter = document.getElementById('monthFilter').value;
            if (!monthFilter) return;
            
            const [year, month] = monthFilter.split('-');
            const filteredTransactions = transactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate.getFullYear() == year && (tDate.getMonth() + 1) == month;
            });
            
            displayMonthlyData(filteredTransactions, monthFilter);
        }
        
        function displayMonthlyData(data, month) {
            const container = document.getElementById('monthlyData');
            const totalIncome = data.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = data.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            
            container.innerHTML = `
                <div class="dashboard-cards">
                    <div class="card income-card">
                        <h3>${new Date(month + '-01').toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' })}ã®åå…¥</h3>
                        <div class="amount">Â¥${totalIncome.toLocaleString()}</div>
                    </div>
                    <div class="card expense-card">
                        <h3>${new Date(month + '-01').toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' })}ã®æ”¯å‡º</h3>
                        <div class="amount">Â¥${totalExpense.toLocaleString()}</div>
                    </div>
                    <div class="card balance-card">
                        <h3>æœˆæœ«æ®‹é«˜</h3>
                        <div class="amount">Â¥${(totalIncome - totalExpense).toLocaleString()}</div>
                    </div>
                </div>
                <div class="transactions-list">
                    <h3 style="padding: 20px; margin: 0; background: #f8f9fa; border-bottom: 1px solid #e9ecef;">å–å¼•ä¸€è¦§</h3>
                    <div>${data.length === 0 ? '<div class="no-data">è©²å½“ã™ã‚‹å–å¼•ãŒã‚ã‚Šã¾ã›ã‚“</div>' : 
                        data.sort((a, b) => new Date(b.date) - new Date(a.date))
                            .map(t => `
                                <div class="transaction-item">
                                    <div class="transaction-info">
                                        <div class="transaction-description">${t.description}</div>
                                        <div class="transaction-meta">${t.category} â€¢ ${new Date(t.date).toLocaleDateString('ja-JP')}</div>
                                    </div>
                                    <div class="transaction-amount ${t.type}">
                                        ${t.type === 'income' ? '+' : '-'}Â¥${t.amount.toLocaleString()}
                                    </div>
                                </div>
                            `).join('')
                    }</div>
                </div>
            `;
        }
        
        function filterByYear() {
            const year = document.getElementById('yearFilter').value;
            if (!year) return;
            
            const filteredTransactions = transactions.filter(t => {
                return new Date(t.date).getFullYear() == year;
            });
            
            displayYearlyData(filteredTransactions, year);
        }
        
        function displayYearlyData(data, year) {
            const container = document.getElementById('yearlyData');
            const totalIncome = data.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = data.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            
            container.innerHTML = `
                <div class="dashboard-cards">
                    <div class="card income-card">
                        <h3>${year}å¹´ã®åå…¥</h3>
                        <div class="amount">Â¥${totalIncome.toLocaleString()}</div>
                    </div>
                    <div class="card expense-card">
                        <h3>${year}å¹´ã®æ”¯å‡º</h3>
                        <div class="amount">Â¥${totalExpense.toLocaleString()}</div>
                    </div>
                    <div class="card balance-card">
                        <h3>å¹´æœ«æ®‹é«˜</h3>
                        <div class="amount">Â¥${(totalIncome - totalExpense).toLocaleString()}</div>
                    </div>
                </div>
            `;
        }
        
        function renderCharts() {
            renderCategoryChart();
            renderMonthlyChart();
            renderYearlyChart();
        }
        
        function renderCategoryChart() {
            const canvas = document.getElementById('categoryChart');
            const ctx = canvas.getContext('2d');
            
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const expenses = transactions.filter(t => t.type === 'expense');
            if (expenses.length === 0) {
                ctx.font = '20px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('æ”¯å‡ºãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            const categoryTotals = {};
            expenses.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });
            
            const categories = Object.keys(categoryTotals);
            const totals = Object.values(categoryTotals);
            const total = totals.reduce((sum, val) => sum + val, 0);
            
            // å††ã‚°ãƒ©ãƒ•ã‚’æç”»
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 50;
            
            const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'];
            
            let currentAngle = -Math.PI / 2;
            
            categories.forEach((category, index) => {
                const sliceAngle = (totals[index] / total) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = colors[index % colors.length];
                ctx.fill();
                
                // ãƒ©ãƒ™ãƒ«ã‚’æç”»
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius + 30);
                const labelY = centerY + Math.sin(labelAngle) * (radius + 30);
                
                ctx.fillStyle = '#333';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(category, labelX, labelY);
                ctx.fillText(`Â¥${totals[index].toLocaleString()}`, labelX, labelY + 15);
                
                currentAngle += sliceAngle;
            });
            
            // åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
            const analysisContainer = document.getElementById('categoryAnalysis');
            analysisContainer.innerHTML = `
                <div class="dashboard-cards">
                    ${categories.map((category, index) => `
                        <div class="card expense-card" style="background: ${colors[index % colors.length]}20; border-left: 5px solid ${colors[index % colors.length]};">
                            <h3>${category}</h3>
                            <div class="amount">Â¥${categoryTotals[category].toLocaleString()}</div>
                            <div class="transaction-meta">${((categoryTotals[category] / total) * 100).toFixed(1)}%</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function renderMonthlyChart() {
            const canvas = document.getElementById('monthlyChart');
            const ctx = canvas.getContext('2d');
            
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (transactions.length === 0) {
                ctx.font = '20px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
            const monthlyData = {};
            transactions.forEach(t => {
                const date = new Date(t.date);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = { income: 0, expense: 0 };
                }
                
                if (t.type === 'income') {
                    monthlyData[monthKey].income += t.amount;
                } else {
                    monthlyData[monthKey].expense += t.amount;
                }
            });
            
            const months = Object.keys(monthlyData).sort();
            const maxValue = Math.max(...months.map(month => 
                Math.max(monthlyData[month].income, monthlyData[month].expense)
            ));
            
            if (months.length === 0) return;
            
            // ã‚°ãƒ©ãƒ•ã®è¨­å®š
            const padding = 60;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            const barWidth = chartWidth / months.length / 2 - 10;
            
            // è»¸ã‚’æç”»
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            // Yè»¸
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.stroke();
            
            // Xè»¸
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’æç”»
            months.forEach((month, index) => {
                const x = padding + (index * chartWidth / months.length);
                const incomeHeight = (monthlyData[month].income / maxValue) * chartHeight;
                const expenseHeight = (monthlyData[month].expense / maxValue) * chartHeight;
                
                // åå…¥ãƒãƒ¼
                ctx.fillStyle = '#28a745';
                ctx.fillRect(x, canvas.height - padding - incomeHeight, barWidth, incomeHeight);
                
                // æ”¯å‡ºãƒãƒ¼
                ctx.fillStyle = '#dc3545';
                ctx.fillRect(x + barWidth + 5, canvas.height - padding - expenseHeight, barWidth, expenseHeight);
                
                // æœˆãƒ©ãƒ™ãƒ«
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(month, x + barWidth, canvas.height - padding + 20);
            });
            
            // å‡¡ä¾‹
            ctx.fillStyle = '#28a745';
            ctx.fillRect(canvas.width - 150, 20, 15, 15);
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('åå…¥', canvas.width - 130, 32);
            
            ctx.fillStyle = '#dc3545';
            ctx.fillRect(canvas.width - 150, 40, 15, 15);
            ctx.fillStyle = '#333';
            ctx.fillText('æ”¯å‡º', canvas.width - 130, 52);
        }
        
        function renderYearlyChart() {
            const canvas = document.getElementById('yearlyChart');
            const ctx = canvas.getContext('2d');
            
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (transactions.length === 0) {
                ctx.font = '20px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // å¹´åˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
            const yearlyData = {};
            transactions.forEach(t => {
                const year = new Date(t.date).getFullYear();
                
                if (!yearlyData[year]) {
                    yearlyData[year] = { income: 0, expense: 0 };
                }
                
                if (t.type === 'income') {
                    yearlyData[year].income += t.amount;
                } else {
                    yearlyData[year].expense += t.amount;
                }
            });
            
            const years = Object.keys(yearlyData).sort();
            const maxValue = Math.max(...years.map(year => 
                Math.max(yearlyData[year].income, yearlyData[year].expense)
            ));
            
            if (years.length === 0) return;
            
            // ã‚°ãƒ©ãƒ•ã®è¨­å®š
            const padding = 60;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            const barWidth = chartWidth / years.length / 2 - 10;
            
            // è»¸ã‚’æç”»
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            // Yè»¸
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.stroke();
            
            // Xè»¸
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’æç”»
            years.forEach((year, index) => {
                const x = padding + (index * chartWidth / years.length);
                const incomeHeight = (yearlyData[year].income / maxValue) * chartHeight;
                const expenseHeight = (yearlyData[year].expense / maxValue) * chartHeight;
                
                // åå…¥ãƒãƒ¼
                ctx.fillStyle = '#28a745';
                ctx.fillRect(x, canvas.height - padding - incomeHeight, barWidth, incomeHeight);
                
                // æ”¯å‡ºãƒãƒ¼
                ctx.fillStyle = '#dc3545';
                ctx.fillRect(x + barWidth + 5, canvas.height - padding - expenseHeight, barWidth, expenseHeight);
                
                // å¹´ãƒ©ãƒ™ãƒ«
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(year + 'å¹´', x + barWidth, canvas.height - padding + 20);
            });
            
            // å‡¡ä¾‹
            ctx.fillStyle = '#28a745';
            ctx.fillRect(canvas.width - 150, 20, 15, 15);
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('åå…¥', canvas.width - 130, 32);
            
            ctx.fillStyle = '#dc3545';
            ctx.fillRect(canvas.width - 150, 40, 15, 15);
            ctx.fillStyle = '#333';
            ctx.fillText('æ”¯å‡º', canvas.width - 130, 52);
        }
        
        function saveTransactions() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }
        
        function exportToJSON() {
            const dataStr = JSON.stringify(transactions, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `å®¶è¨ˆç°¿ãƒ‡ãƒ¼ã‚¿_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        function exportToCSV() {
            const csvContent = [
                ['æ—¥ä»˜', 'èª¬æ˜', 'ã‚«ãƒ†ã‚´ãƒª', 'ç¨®é¡', 'é‡‘é¡'],
                ...transactions.map(t => [
                    t.date,
                    t.description,
                    t.category,
                    t.type === 'income' ? 'åå…¥' : 'æ”¯å‡º',
                    t.amount
                ])
            ].map(row => row.join(',')).join('\n');
            
            const BOM = '\uFEFF';
            const dataUri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(BOM + csvContent);
            
            const exportFileDefaultName = `å®¶è¨ˆç°¿ãƒ‡ãƒ¼ã‚¿_${new Date().toISOString().split('T')[0]}.csv`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (file.name.endsWith('.json')) {
                        const importedData = JSON.parse(e.target.result);
                        if (confirm('ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ')) {
                            transactions = importedData;
                            saveTransactions();
                            initializeApp();
                            alert('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚');
                        }
                    } else if (file.name.endsWith('.csv')) {
                        const csvData = e.target.result;
                        const lines = csvData.split('\n');
                        const importedTransactions = [];
                        
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (line) {
                                const [date, description, category, type, amount] = line.split(',');
                                importedTransactions.push({
                                    id: Date.now() + i,
                                    date: date,
                                    description: description,
                                    category: category,
                                    type: type === 'åå…¥' ? 'income' : 'expense',
                                    amount: parseFloat(amount),
                                    timestamp: new Date().toISOString()
                                });
                            }
                        }
                        
                        if (confirm('ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ')) {
                            transactions = importedTransactions;
                            saveTransactions();
                            initializeApp();
                            alert('CSVãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚');
                        }
                    }
                } catch (error) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
                }
            };
            reader.readAsText(file);
        }
        
        function clearAllData() {
            if (confirm('æœ¬å½“ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
                if (confirm('æœ€å¾Œã®ç¢ºèªã§ã™ã€‚ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ')) {
                    transactions = [];
                    saveTransactions();
                    initializeApp();
                    alert('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
                }
            }
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        document.getElementById('transactionForm').addEventListener('submit', addTransaction);
        
        // æœˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®åˆæœŸå€¤ã‚’è¨­å®š
        const currentDate = new Date();
        const currentMonth = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
        document.getElementById('monthFilter').value = currentMonth;
        
        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®å¤‰æ•°
        let exportPeriod = 'all';
        
        function setExportPeriod(period) {
            exportPeriod = period;
            const customSettings = document.getElementById('customPeriodSettings');
            
            if (period === 'custom') {
                customSettings.style.display = 'block';
            } else {
                customSettings.style.display = 'none';
            }
            
            updateExportInfo();
        }
        
        function updateExportInfo() {
            const filteredTransactions = getFilteredTransactionsForExport();
            const countElement = document.getElementById('exportTargetCount');
            const infoElement = document.getElementById('exportPeriodInfo');
            
            if (countElement) {
                countElement.textContent = `${filteredTransactions.length}ä»¶`;
            }
            
            if (infoElement) {
                const today = new Date();
                let info = '';
                
                switch (exportPeriod) {
                    case 'current-month':
                        info = ` (${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ)`;
                        break;
                    case 'current-year':
                        info = ` (${today.getFullYear()}å¹´)`;
                        break;
                    case 'custom':
                        const startDate = document.getElementById('exportStartDate')?.value;
                        const endDate = document.getElementById('exportEndDate')?.value;
                        if (startDate && endDate) {
                            info = ` (${startDate} ï½ ${endDate})`;
                        }
                        break;
                }
                
                infoElement.textContent = info;
            }
        }
        
        function getFilteredTransactionsForExport() {
            if (exportPeriod === 'all') {
                return transactions;
            }
            
            const today = new Date();
            let startDate, endDate;
            
            switch (exportPeriod) {
                case 'current-month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    break;
                case 'current-year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = new Date(today.getFullYear(), 11, 31);
                    break;
                case 'custom':
                    const startDateStr = document.getElementById('exportStartDate')?.value;
                    const endDateStr = document.getElementById('exportEndDate')?.value;
                    if (!startDateStr || !endDateStr) return [];
                    startDate = new Date(startDateStr);
                    endDate = new Date(endDateStr);
                    break;
                default:
                    return transactions;
            }
            
            const startDateStr = startDate.toISOString().split('T')[0];
            const endDateStr = endDate.toISOString().split('T')[0];
            
            return transactions.filter(transaction => {
                return transaction.date >= startDateStr && transaction.date <= endDateStr;
            });
        }
        
        function exportFilteredJSON() {
            const filteredTransactions = getFilteredTransactionsForExport();
            const dataToExport = {
                transactions: filteredTransactions,
                exportDate: new Date().toISOString(),
                period: exportPeriod,
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            // ãƒ•ã‚¡ã‚¤ãƒ«åã«æœŸé–“æƒ…å ±ã‚’å«ã‚ã‚‹
            const today = new Date();
            let filename = 'å®¶è¨ˆç°¿ãƒ‡ãƒ¼ã‚¿';
            if (exportPeriod === 'current-month') {
                filename += `_${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ`;
            } else if (exportPeriod === 'current-year') {
                filename += `_${today.getFullYear()}å¹´`;
            } else if (exportPeriod === 'custom') {
                const startDate = document.getElementById('exportStartDate')?.value;
                const endDate = document.getElementById('exportEndDate')?.value;
                if (startDate && endDate) {
                    filename += `_${startDate}_${endDate}`;
                }
            } else {
                filename += `_å…¨æœŸé–“`;
            }
            filename += `_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', filename);
            linkElement.click();
        }
        
        function exportFilteredCSV() {
            const filteredTransactions = getFilteredTransactionsForExport();
            const csvContent = [
                ['æ—¥ä»˜', 'èª¬æ˜', 'ã‚«ãƒ†ã‚´ãƒª', 'ç¨®é¡', 'é‡‘é¡'],
                ...filteredTransactions.map(t => [
                    t.date,
                    t.description,
                    t.category,
                    t.type === 'income' ? 'åå…¥' : 'æ”¯å‡º',
                    t.amount
                ])
            ].map(row => row.join(',')).join('\n');
            
            const BOM = '\uFEFF';
            const dataUri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(BOM + csvContent);
            
            // ãƒ•ã‚¡ã‚¤ãƒ«åã«æœŸé–“æƒ…å ±ã‚’å«ã‚ã‚‹
            const today = new Date();
            let filename = 'å®¶è¨ˆç°¿ãƒ‡ãƒ¼ã‚¿';
            if (exportPeriod === 'current-month') {
                filename += `_${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ`;
            } else if (exportPeriod === 'current-year') {
                filename += `_${today.getFullYear()}å¹´`;
            } else if (exportPeriod === 'custom') {
                const startDate = document.getElementById('exportStartDate')?.value;
                const endDate = document.getElementById('exportEndDate')?.value;
                if (startDate && endDate) {
                    filename += `_${startDate}_${endDate}`;
                }
            } else {
                filename += `_å…¨æœŸé–“`;
            }
            filename += `_${new Date().toISOString().split('T')[0]}.csv`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', filename);
            linkElement.click();
        }
        
        function generateShareUrl() {
            const encodedData = btoa(JSON.stringify(transactions));
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?data=${encodedData}`;
            
            document.getElementById('shareUrlInput').value = shareUrl;
            document.getElementById('shareUrlContainer').style.display = 'block';
            document.getElementById('copyUrlBtn').style.display = 'inline-block';
        }
        
        function copyShareUrl() {
            const shareUrlInput = document.getElementById('shareUrlInput');
            shareUrlInput.select();
            shareUrlInput.setSelectionRange(0, 99999); // ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
            
            try {
                navigator.clipboard.writeText(shareUrlInput.value).then(function() {
                    showCopyMessage();
                }).catch(function() {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    document.execCommand('copy');
                    showCopyMessage();
                });
            } catch (err) {
                // ã•ã‚‰ãªã‚‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                document.execCommand('copy');
                showCopyMessage();
            }
        }
        
        function showCopyMessage() {
            const copyMessage = document.getElementById('copyMessage');
            copyMessage.style.display = 'block';
            setTimeout(() => {
                copyMessage.style.display = 'none';
            }, 2000);
        }
        
        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ï¼ˆå…±æœ‰URLæ©Ÿèƒ½ï¼‰
        function loadSharedData() {
            const urlParams = new URLSearchParams(window.location.search);
            const sharedData = urlParams.get('data');
            if (sharedData) {
                try {
                    const decodedData = JSON.parse(atob(sharedData));
                    transactions = decodedData;
                    saveTransactions();
                    initializeApp();
                    alert('å…±æœ‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼');
                } catch (error) {
                    console.error('å…±æœ‰ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                }
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å…±æœ‰ãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯
        loadSharedData();
        
        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæƒ…å ±ã‚’å®šæœŸçš„ã«æ›´æ–°
        setInterval(updateExportInfo, 1000);
    </script>
</body>
</html>
