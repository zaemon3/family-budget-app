<td className="px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold">
                                Â¥{year.income.toLocaleString()}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold">
                                Â¥{year.expense.toLocaleString()}
                              </td>
                              <td className={`px-6 py-4 whitespace-nowrap text-sm font-semibold ${
                                year.balance >= 0 ? 'text-blue-600' : 'text-orange-600'
                              }`}>
                                Â¥{year.balance.toLocaleString()}
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </>
              )}

              {/* æ”¯å‡ºåˆ†æã‚¿ãƒ– */}
              {activeTab === 'analysis' && (
                <>
                  <div className="bg-white p-6 rounded-lg shadow-lg mb-8">
                    <div className="flex items-center justify-between mb-6">
                      <h2 className="text-xl font-semibold text-gray-700 flex items-center">
                        <PieChart className="h-6 w-6 mr-2" />
                        æ”¯å‡ºåˆ†æ
                      </h2>
                      <div className="flex items-center space-x-4">
                        <div className="flex items-center space-x-2">
                          <label className="text-sm font-medium text-gray-700">æœˆ:</label>
                          <select
                            value={selectedMonth}
                            onChange={(e) => setSelectedMonth(e.target.value)}
                            className="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            {Array.from({length: 12}, (_, i) => {
                              const month = `${selectedMonth.slice(0, 4)}-${(i + 1).toString().padStart(2, '0')}`;
                              return (
                                <option key={month} value={month}>
                                  {new Date(month + '-01').toLocaleDateString('ja-JP', { month: 'long' })}
                                </option>
                              );
                            })}
                          </select>
                        </div>
                      </div>
                    </div>

                    {/* æœˆåˆ¥åˆ†æ */}
                    <div className="mb-8">
                      <h3 className="text-lg font-semibold text-gray-700 mb-4">æœˆåˆ¥æ”¯å‡ºåˆ†æ</h3>
                      {categoryAnalysis.length === 0 ? (
                        <div className="text-center py-8 text-gray-500">
                          <PieChart className="h-12 w-12 mx-auto mb-4 text-gray-300" />
                          <p>é¸æŠã—ãŸæœˆã«æ”¯å‡ºãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                      ) : (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                          {/* å††ã‚°ãƒ©ãƒ• */}
                          <div className="bg-gray-50 p-6 rounded-lg">
                            <h4 className="text-lg font-semibold text-gray-700 mb-4 text-center">æ”¯å‡ºå‰²åˆ</h4>
                            <div className="flex justify-center mb-4">
                              <svg width="300" height="300" viewBox="0 0 300 300" className="transform -rotate-90">
                                {(() => {
                                  let cumulativePercentage = 0;
                                  const colors = [
                                    '#ef4444', '#3b82f6', '#10b981', '#f59e0b',
                                    '#a855f7', '#ec4899', '#6366f1', '#6b7280'
                                  ];
                                  
                                  return categoryAnalysis.map((item, index) => {
                                    const percentage = parseFloat(item.percentage);
                                    const startAngle = (cumulativePercentage / 100) * 360;
                                    const endAngle = ((cumulativePercentage + percentage) / 100) * 360;
                                    cumulativePercentage += percentage;
                                    
                                    const startAngleRad = (startAngle * Math.PI) / 180;
                                    const endAngleRad = (endAngle * Math.PI) / 180;
                                    
                                    const largeArcFlag = percentage > 50 ? 1 : 0;
                                    const radius = 120;
                                    const centerX = 150;
                                    const centerY = 150;
                                    
                                    const x1 = centerX + radius * Math.cos(startAngleRad);
                                    const y1 = centerY + radius * Math.sin(startAngleRad);
                                    const x2 = centerX + radius * Math.cos(endAngleRad);
                                    const y2 = centerY + radius * Math.sin(endAngleRad);
                                    
                                    const pathData = [
                                      `M ${centerX} ${centerY}`,
                                      `L ${x1} ${y1}`,
                                      `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                                      'Z'
                                    ].join(' ');
                                    
                                    return (
                                      <path
                                        key={item.category}
                                        d={pathData}
                                        fill={colors[index % colors.length]}
                                        stroke="white"
                                        strokeWidth="2"
                                        className="hover:opacity-80 transition-opacity"
                                      />
                                    );
                                  });
                                })()}
                              </svg>
                            </div>
                            
                            {/* å‡¡ä¾‹ */}
                            <div className="grid grid-cols-2 gap-2">
                              {categoryAnalysis.map((item, index) => {
                                const colors = [
                                  'bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500',
                                  'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-gray-500'
                                ];
                                const color = colors[index % colors.length];
                                
                                return (
                                  <div key={item.category} className="flex items-center space-x-2">
                                    <div className={`w-3 h-3 rounded-full ${color}`}></div>
                                    <span className="text-sm text-gray-700 truncate">{item.category}</span>
                                    <span className="text-xs text-gray-500">{item.percentage}%</span>
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                          
                          {/* è©³ç´°ãƒªã‚¹ãƒˆ */}
                          <div>
                            <h4 className="text-lg font-semibold text-gray-700 mb-4">è©³ç´°ãƒ‡ãƒ¼ã‚¿</h4>
                            <div className="mb-6">
                              <p className="text-lg font-semibold text-gray-700 mb-2">
                                {new Date(selectedMonth + '-01').toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' })}ã®ç·æ”¯å‡º: 
                                <span className="text-red-600 ml-2">Â¥{monthlyExpense.toLocaleString()}</span>
                              </p>
                            </div>

                            <div className="space-y-4">
                              {categoryAnalysis.map((item, index) => {
                                const colors = [
                                  'bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500',
                                  'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-gray-500'
                                ];
                                const color = colors[index % colors.length];
                                
                                return (
                                  <div key={item.category} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div className="flex items-center space-x-3">
                                      <div className={`w-4 h-4 rounded-full ${color}`}></div>
                                      <span className="font-medium text-gray-800">{item.category}</span>
                                    </div>
                                    
                                    <div className="flex items-center space-x-4">
                                      <div className="flex-1 bg-gray-200 rounded-full h-2 w-32">
                                        <div 
                                          className={`h-2 rounded-full ${color}`}
                                          style={{ width: `${item.percentage}%` }}
                                        ></div>
                                      </div>
                                      <div className="text-right">
                                        <p className="font-semibold text-gray-800">Â¥{item.amount.toLocaleString()}</p>
                                        <p className="text-sm text-gray-600">{item.percentage}%</p>
                                      </div>
                                    </div>
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        </div>
                      )}
                    </div>

                    {/* å¹´åˆ¥åˆ†æ */}
                    <div>
                      <h3 className="text-lg font-semibold text-gray-700 mb-4">å¹´åˆ¥æ”¯å‡ºåˆ†æ</h3>
                      <div className="flex items-center justify-between mb-4">
                        <span></span>
                        <div className="flex items-center space-x-2">
                          <label className="text-sm font-medium text-gray-700">å¹´:</label>
                          <select
                            value={selectedYear}
                            onChange={(e) => setSelectedYear(e.target.value)}
                            className="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            {[...Array(10)].map((_, i) => {
                              const year = new Date().getFullYear() - i;
                              return (
                                <option key={year} value={year}>{year}å¹´</option>
                              );
                            })}
                          </select>
                        </div>
                      </div>
                      
                      {yearlyCategoryAnalysis.length === 0 ? (
                        <div className="text-center py-8 text-gray-500">
                          <PieChart className="h-12 w-12 mx-auto mb-4 text-gray-300" />
                          <p>é¸æŠã—ãŸå¹´ã«æ”¯å‡ºãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                      ) : (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                          {/* å††ã‚°ãƒ©ãƒ• */}
                          <div className="bg-gray-50 p-6 rounded-lg">
                            <h4 className="text-lg font-semibold text-gray-700 mb-4 text-center">å¹´é–“æ”¯å‡ºå‰²åˆ</h4>
                            <div className="flex justify-center mb-4">
                              <svg width="300" height="300" viewBox="0 0 300 300" className="transform -rotate-90">
                                {(() => {
                                  let cumulativePercentage = 0;
                                  const colors = [
                                    '#ef4444', '#3b82f6', '#10b981', '#f59e0b',
                                    '#a855f7', '#ec4899', '#6366f1', '#6b7280'
                                  ];
                                  
                                  return yearlyCategoryAnalysis.map((item, index) => {
                                    const percentage = parseFloat(item.percentage);
                                    const startAngle = (cumulativePercentage / 100) * 360;
                                    const endAngle = ((cumulativePercentage + percentage) / 100) * 360;
                                    cumulativePercentage += percentage;
                                    
                                    const startAngleRad = (startAngle * Math.PI) / 180;
                                    const endAngleRad = (endAngle * Math.PI) / 180;
                                    
                                    const largeArcFlag = percentage > 50 ? 1 : 0;
                                    const radius = 120;
                                    const centerX = 150;
                                    const centerY = 150;
                                    
                                    const x1 = centerX + radius * Math.cos(startAngleRad);
                                    const y1 = centerY + radius * Math.sin(startAngleRad);
                                    const x2 = centerX + radius * Math.cos(endAngleRad);
                                    const y2 = centerY + radius * Math.sin(endAngleRad);
                                    
                                    const pathData = [
                                      `M ${centerX} ${centerY}`,
                                      `L ${x1} ${y1}`,
                                      `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                                      'Z'
                                    ].join(' ');
                                    
                                    return (
                                      <path
                                        key={item.category}
                                        d={pathData}
                                        fill={colors[index % colors.length]}
                                        stroke="white"
                                        strokeWidth="2"
                                        className="hover:opacity-80 transition-opacity"
                                      />
                                    );
                                  });
                                })()}
                              </svg>
                            </div>
                            
                            {/* å‡¡ä¾‹ */}
                            <div className="grid grid-cols-2 gap-2">
                              {yearlyCategoryAnalysis.map((item, index) => {
                                const colors = [
                                  'bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500',
                                  'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-gray-500'
                                ];
                                const color = colors[index % colors.length];
                                
                                return (
                                  <div key={item.category} className="flex items-center space-x-2">
                                    <div className={`w-3 h-3 rounded-full ${color}`}></div>
                                    <span className="text-sm text-gray-700 truncate">{item.category}</span>
                                    <span className="text-xs text-gray-500">{item.percentage}%</span>
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                          
                          {/* è©³ç´°ãƒªã‚¹ãƒˆ */}
                          <div>
                            <h4 className="text-lg font-semibold text-gray-700 mb-4">è©³ç´°ãƒ‡ãƒ¼ã‚¿</h4>
                            <div className="mb-6">
                              <p className="text-lg font-semibold text-gray-700 mb-2">
                                {selectedYear}å¹´ã®ç·æ”¯å‡º: 
                                <span className="text-red-600 ml-2">Â¥{yearlyExpense.toLocaleString()}</span>
                              </p>
                            </div>

                            <div className="space-y-4">
                              {yearlyCategoryAnalysis.map((item, index) => {
                                const colors = [
                                  'bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500',
                                  'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-gray-500'
                                ];
                                const color = colors[index % colors.length];
                                
                                return (
                                  <div key={item.category} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div className="flex items-center space-x-3">
                                      <div className={`w-4 h-4 rounded-full ${color}`}></div>
                                      <span className="font-medium text-gray-800">{item.category}</span>
                                    </div>
                                    
                                    <div className="flex items-center space-x-4">
                                      <div className="flex-1 bg-gray-200 rounded-full h-2 w-32">
                                        <div 
                                          className={`h-2 rounded-full ${color}`}
                                          style={{ width: `${item.percentage}%` }}
                                        ></div>
                                      </div>
                                      <div className="text-right">
                                        <p className="font-semibold text-gray-800">Â¥{item.amount.toLocaleString()}</p>
                                        <p className="text-sm text-gray-600">{item.percentage}%</p>
                                      </div>
                                    </div>
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                </>
              )}

              {/* å…±æœ‰ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¿ãƒ– */}
              {activeTab === 'backup' && (
                <>
                  <div className="bg-white p-6 rounded-lg shadow-lg mb-8">
                    <h2 className="text-xl font-semibold text-gray-700 mb-6 flex items-center">
                      <Share2 className="h-6 w-6 mr-2" />
                      ãƒ‡ãƒ¼ã‚¿ã®å…±æœ‰ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
                    </h2>

                    {/* ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ */}
                    <div className="mb-8">
                      <h3 className="text-lg font-semibold text-gray-700 mb-4">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h3>
                      
                      {/* æœŸé–“é¸æŠ */}
                      <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                        <h4 className="font-semibold text-gray-700 mb-3">ä¿å­˜æœŸé–“ã‚’é¸æŠ</h4>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
                          <label className="flex items-center space-x-2 cursor-pointer">
                            <input
                              type="radio"
                              name="exportPeriod"
                              value="all"
                              checked={exportPeriod === 'all'}
                              onChange={(e) => setExportPeriod(e.target.value)}
                              className="text-blue-500"
                            />
                            <span className="text-sm">å…¨æœŸé–“</span>
                          </label>
                          <label className="flex items-center space-x-2 cursor-pointer">
                            <input
                              type="radio"
                              name="exportPeriod"
                              value="current-month"
                              checked={exportPeriod === 'current-month'}
                              onChange={(e) => setExportPeriod(e.target.value)}
                              className="text-blue-500"
                            />
                            <span className="text-sm">ä»Šæœˆ</span>
                          </label>
                          <label className="flex items-center space-x-2 cursor-pointer">
                            <input
                              type="radio"
                              name="exportPeriod"
                              value="current-year"
                              checked={exportPeriod === 'current-year'}
                              onChange={(e) => setExportPeriod(e.target.value)}
                              className="text-blue-500"
                            />
                            <span className="text-sm">ä»Šå¹´</span>
                          </label>
                          <label className="flex items-center space-x-2 cursor-pointer">
                            <input
                              type="radio"
                              name="exportPeriod"
                              value="custom"
                              checked={exportPeriod === 'custom'}
                              onChange={(e) => setExportPeriod(e.target.value)}
                              className="text-blue-500"
                            />
                            <span className="text-sm">æœŸé–“æŒ‡å®š</span>
                          </label>
                        </div>
                        
                        {/* ã‚«ã‚¹ã‚¿ãƒ æœŸé–“è¨­å®š */}
                        {exportPeriod === 'custom' && (
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-300">
                            <div>
                              <label className="block text-sm font-medium text-gray-700 mb-2">é–‹å§‹æ—¥</label>
                              <input
                                type="date"
                                value={exportStartDate}
                                onChange={(e) => setExportStartDate(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium text-gray-700 mb-2">çµ‚äº†æ—¥</label>
                              <input
                                type="date"
                                value={exportEndDate}
                                onChange={(e) => setExportEndDate(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              />
                            </div>
                          </div>
                        )}
                        
                        {/* é¸æŠã•ã‚ŒãŸæœŸé–“ã®æƒ…å ±è¡¨ç¤º */}
                        <div className="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                          <p className="text-sm text-blue-700">
                            ğŸ“Š å¯¾è±¡ä»¶æ•°: <strong>{getFilteredTransactions().length}ä»¶</strong>
                            {exportPeriod === 'current-month' && ` (${new Date().getFullYear()}å¹´${new Date().getMonth() + 1}æœˆ)`}
                            {exportPeriod === 'current-year' && ` (${new Date().getFullYear()}å¹´)`}
                            {exportPeriod === 'custom' && exportStartDate && exportEndDate && ` (${exportStartDate} ï½ ${exportEndDate})`}
                          </p>
                        </div>
                      </div>
                      
                      <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-4">
                        <p className="text-sm text-blue-700 mb-2">
                          å®¶è¨ˆç°¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ãŸã‚Šã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦ä¿å­˜ã§ãã¾ã™ã€‚
                        </p>
                      </div>
                      <div className="flex flex-col sm:flex-row gap-2">
                        <button
                          onClick={exportData}
                          disabled={exportPeriod === 'custom' && (!exportStartDate || !exportEndDate)}
                          className="flex items-center justify-center px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium"
                        >
                          <Download className="h-5 w-5 mr-2" />
                          JSONã§ä¿å­˜
                        </button>
                        <button
                          onClick={exportCSV}
                          disabled={exportPeriod === 'custom' && (!exportStartDate || !exportEndDate)}
                          className="flex items-center justify-center px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium"
                        >
                          <Download className="h-5 w-5 mr-2" />
                          CSVã§ä¿å­˜
                        </button>
                      </div>
                      <div className="mt-3 text-xs text-gray-600">
                        <p><strong>JSON:</strong> å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆæ¨å¥¨ï¼‰</p>
                        <p><strong>CSV:</strong> Excelãƒ»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§é–‹ã‘ã‚‹å½¢å¼</p>
                      </div>
                    </div>

                    {/* ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ */}
                    <div className="mb-8">
                      <h3 className="text-lg font-semibold text-gray-700 mb-4">ğŸ“‚ ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒ</h3>
                      <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4">
                        <p className="text-sm text-yellow-700 mb-2">
                          âš ï¸ æ³¨æ„: ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã™ã‚‹ã¨ã€ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦äº‹å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã£ã¦ãã ã•ã„ã€‚
                        </p>
                        <p className="text-sm text-yellow-700">
                          ğŸ“„ å¯¾å¿œå½¢å¼: JSONã€CSVï¼ˆExcelç­‰ã§ç·¨é›†å¯èƒ½ï¼‰
                        </p>
                      </div>
                      <div className="flex items-center">
                        <input
                          type="file"
                          accept=".json,.csv"
                          onChange={importData}
                          className="hidden"
                          id="import-file"
                        />
                        <label
                          htmlFor="import-file"
                          className="flex items-center px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium cursor-pointer"
                        >
                          <Upload className="h-5 w-5 mr-2" />
                          ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦å¾©å…ƒ
                        </label>
                      </div>
                    </div>

                    {/* URLå…±æœ‰ */}
                    <div className="mb-8">
                      <h3 className="text-lg font-semibold text-gray-700 mb-4">ğŸ”— URLã§å…±æœ‰</h3>
                      <div className="bg-green-50 p-4 rounded-lg border border-green-200 mb-4">
                        <p className="text-sm text-green-700 mb-2">
                          ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€URLã‚’ç”Ÿæˆã—ã¦ã€å®¶æ—ã‚„ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã¨å…±æœ‰ã§ãã¾ã™ã€‚URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã ã‘ã§ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
                        </p>
                      </div>
                      <div className="flex space-x-2">
                        <button
                          onClick={generateShareUrl}
                          className="flex items-center px-6 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors font-medium"
                        >
                          <Share2 className="h-5 w-5 mr-2" />
                          å…±æœ‰URLã‚’ç”Ÿæˆ
                        </button>
                        {shareUrl && (
                          <button
                            onClick={copyToClipboard}
                            className="flex items-center px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-medium"
                          >
                            <Copy className="h-5 w-5 mr-2" />
                            URLã‚’ã‚³ãƒ”ãƒ¼
                          </button>
                        )}
                      </div>
                      
                      {shareUrl && (
                        <div className="mt-4 p-3 bg-gray-100 rounded-lg">
                          <p className="text-sm text-gray-600 mb-2">ç”Ÿæˆã•ã‚ŒãŸå…±æœ‰URL:</p>
                          <div className="flex items-center space-x-2">
                            <input
                              type="text"
                              value={shareUrl}
                              readOnly
                              className="flex-1 p-2 border border-gray-300 rounded text-sm bg-white"
                            />
                          </div>
                        </div>
                      )}
                      
                      {showCopyMessage && (
                        <div className="mt-2 p-2 bg-green-100 text-green-700 rounded text-sm">
                          âœ… URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
                        </div>
                      )}
                    </div>

                    {/* ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ */}
                    <div className="mb-8">
                      <h3 className="text-lg font-semibold text-gray-700 mb-4">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤</h3>
                      <div className="bg-red-50 p-4 rounded-lg border border-red-200 mb-4">
                        <p className="text-sm text-red-700 mb-2">
                          âš ï¸ è­¦å‘Š: ã“ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã™ã¹ã¦ã®å–å¼•ãƒ‡ãƒ¼ã‚¿ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚
                        </p>
                      </div>
                      <button
                        onClick={clearAllData}
                        className="flex items-center px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-medium"
                      >
                        <Trash2 className="h-5 w-5 mr-2" />
                        ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                      </button>
                    </div>

                    {/* ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ */}
                    <div className="bg-gray-50 p-6 rounded-lg">
                      <h3 className="text-lg font-semibold text-gray-700 mb-4">ğŸ“– ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h3>
                      <div className="space-y-4 text-sm text-gray-600">
                        <div>
                          <h4 className="font-semibold text-gray-700">ğŸ’¾ è‡ªå‹•ä¿å­˜æ©Ÿèƒ½</h4>
                          <p>ãƒ‡ãƒ¼ã‚¿ã¯å…¥åŠ›ã¨åŒæ™‚ã«è‡ªå‹•çš„ã«ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ã€å†åº¦é–‹ãã¨ãã«ãƒ‡ãƒ¼ã‚¿ãŒå¾©å…ƒã•ã‚Œã¾ã™ã€‚</p>
                        </div>
                        <div>
                          <h4 className="font-semibold text-gray-700">ğŸ  å®¶æ—é–“ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰</h4>
                          <p>1. ã€Œå…±æœ‰URLã‚’ç”Ÿæˆã€ã§URLã‚’ä½œæˆ</p>
                          <p>2. ã€ŒURLã‚’ã‚³ãƒ”ãƒ¼ã€ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</p>
                          <p>4. å—ã‘å–ã£ãŸäººãŒURLã«ã‚¢ã‚¯ã‚»ã‚¹</p>
                        </div>
                        <div>
                          <h4 className="font-semibold text-gray-700">ğŸ“Š CSVãƒ•ã‚¡ã‚¤ãƒ«ã§ã®æ´»ç”¨</h4>
                          <p>1. ã€ŒCSVã§ä¿å­˜ã€ã§ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>
                          <p>2. Excelãƒ»Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§é–‹ã„ã¦ç·¨é›†</p>
                          <p>3. ç·¨é›†å¾Œã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦å¾©å…ƒã€ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</p>
                          <p>4. ã‚°ãƒ©ãƒ•ä½œæˆã‚„è©³ç´°åˆ†æã«æ´»ç”¨</p>
                        </div>
                        <div>
                          <h4 className="font-semibold text-gray-700">ğŸ“± ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã®åˆ©ç”¨</h4>
                          <p>1. ã€ŒJSONã§ä¿å­˜ã€ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜</p>
                          <p>2. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã«è»¢é€ï¼ˆãƒ¡ãƒ¼ãƒ«æ·»ä»˜ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãªã©ï¼‰</p>
                          <p>3. ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦å¾©å…ƒã€</p>
                        </div>
                        <div>
                          <h4 className="font-semibold text-gray-700">ğŸ’¾ å®šæœŸçš„ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h4>
                          <p>æœˆæœ«ãªã©ã«å®šæœŸçš„ã«ã€ŒJSONã§ä¿å­˜ã€ã‚’å®Ÿè¡Œã—ã¦ã€é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã«ä¿ç®¡ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </>
              )}
            </div>
          );
        };

        ReactDOM.render(<HouseholdBudgetApp />, document.getElementById('root'));
    </script>
</body>
</html>
                                                    <p className="text-sm text-green-700">
                            ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•çš„ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚å®‰å¿ƒã§ã™ï¼
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */}
                  <div className="bg-white p-6 rounded-lg shadow-lg mb-8">
                    <h2 className="text-xl font-semibold mb-4 text-gray-700">
                      {editingTransaction ? 'å–å¼•ã‚’ç·¨é›†' : 'æ–°ã—ã„å–å¼•ã‚’è¿½åŠ '}
                    </h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">ç¨®é¡</label>
                        <div className="flex space-x-4">
                          <button
                            onClick={() => setType('income')}
                            className={`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${
                              type === 'income' 
                                ? 'bg-green-500 text-white' 
                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                          >
                            <PlusCircle className="h-4 w-4 mr-2" />
                            åå…¥
                          </button>
                          <button
                            onClick={() => setType('expense')}
                            className={`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${
                              type === 'expense' 
                                ? 'bg-red-500 text-white' 
                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                          >
                            <MinusCircle className="h-4 w-4 mr-2" />
                            æ”¯å‡º
                          </button>
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">é‡‘é¡</label>
                        <input
                          type="number"
                          value={amount}
                          onChange={(e) => setAmount(e.target.value)}
                          placeholder="0"
                          className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">ã‚«ãƒ†ã‚´ãƒª</label>
                        <select
                          value={category}
                          onChange={(e) => setCategory(e.target.value)}
                          className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</option>
                          {type === 'expense' ? (
                            <>
                              <optgroup label="å›ºå®šè²»">
                                {expenseCategories['å›ºå®šè²»'].map(cat => (
                                  <option key={cat.name} value={cat.name}>{cat.name}</option>
                                ))}
                              </optgroup>
                              <optgroup label="å¤‰å‹•è²»">
                                {expenseCategories['å¤‰å‹•è²»'].map(cat => (
                                  <option key={cat.name} value={cat.name}>{cat.name}</option>
                                ))}
                              </optgroup>
                            </>
                          ) : (
                            incomeCategories.map(cat => (
                              <option key={cat} value={cat}>{cat}</option>
                            ))
                          )}
                        </select>
                        
                        {/* ã‚«ãƒ†ã‚´ãƒªã®èª¬æ˜ */}
                        {category && type === 'expense' && (
                          <div className="mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p className="text-sm text-blue-700">
                              <span className="font-medium">{category}:</span> {getCategoryDescription(category)}
                            </p>
                          </div>
                        )}
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">æ—¥ä»˜</label>
                        <input
                          type="date"
                          value={transactionDate}
                          onChange={(e) => setTransactionDate(e.target.value)}
                          className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">èª¬æ˜ï¼ˆä»»æ„ï¼‰</label>
                        <input
                          type="text"
                          value={description}
                          onChange={(e) => setDescription(e.target.value)}
                          placeholder="å–å¼•ã®è©³ç´°"
                          className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                      </div>
                    </div>

                    <div className="flex space-x-2">
                      {editingTransaction ? (
                        <>
                          <button
                            onClick={saveEdit}
                            disabled={!amount || !category}
                            className="flex-1 bg-green-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center"
                          >
                            <Check className="h-4 w-4 mr-2" />
                            å¤‰æ›´ã‚’ä¿å­˜
                          </button>
                          <button
                            onClick={cancelEdit}
                            className="flex-1 bg-gray-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-gray-600 transition-colors flex items-center justify-center"
                          >
                            <X className="h-4 w-4 mr-2" />
                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                          </button>
                        </>
                      ) : (
                        <button
                          onClick={addTransaction}
                          disabled={!amount || !category}
                          className="w-full bg-blue-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
                        >
                          å–å¼•ã‚’è¿½åŠ 
                        </button>
                      )}
                    </div>
                  </div>

                  {/* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
                  <div className="mb-6">
                    <div className="flex space-x-2">
                      <button
                        onClick={() => setFilter('all')}
                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                          filter === 'all' ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'
                        }`}
                      >
                        ã™ã¹ã¦
                      </button>
                      <button
                        onClick={() => setFilter('income')}
                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                          filter === 'income' ? 'bg-green-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'
                        }`}
                      >
                        åå…¥ã®ã¿
                      </button>
                      <button
                        onClick={() => setFilter('expense')}
                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                          filter === 'expense' ? 'bg-red-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'
                        }`}
                      >
                        æ”¯å‡ºã®ã¿
                      </button>
                    </div>
                  </div>

                  {/* å–å¼•å±¥æ­´ */}
                  <div className="bg-white rounded-lg shadow-lg">
                    <div className="p-6 border-b border-gray-200">
                      <h2 className="text-xl font-semibold text-gray-700">ä»Šæ—¥ã®å–å¼•å±¥æ­´</h2>
                      <p className="text-sm text-gray-500 mt-1">
                        {new Date().toLocaleDateString('ja-JP', { 
                          year: 'numeric', 
                          month: 'long', 
                          day: 'numeric',
                          weekday: 'long'
                        })}
                      </p>
                    </div>
                    
                    <div className="max-h-96 overflow-y-auto">
                      {todaysTransactions.length === 0 ? (
                        <div className="p-8 text-center text-gray-500">
                          <Calendar className="h-12 w-12 mx-auto mb-4 text-gray-300" />
                          <p>ä»Šæ—¥ã¯ã¾ã å–å¼•ãŒã‚ã‚Šã¾ã›ã‚“</p>
                          <p className="text-sm text-gray-400 mt-1">å–å¼•ã‚’è¿½åŠ ã—ã¦å®¶è¨ˆç°¿ã‚’å§‹ã‚ã¾ã—ã‚‡ã†</p>
                        </div>
                      ) : (
                        todaysTransactions.map(transaction => (
                          <div key={transaction.id} className="p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors">
                            <div className="flex items-center justify-between">
                              <div className="flex-1">
                                <div className="flex items-center space-x-3">
                                  <div className={`w-3 h-3 rounded-full ${
                                    transaction.type === 'income' ? 'bg-green-500' : 'bg-red-500'
                                  }`}></div>
                                  <div>
                                    <p className="font-medium text-gray-800">{transaction.category}</p>
                                    {transaction.description && (
                                      <p className="text-sm text-gray-600">{transaction.description}</p>
                                    )}
                                    <p className="text-xs text-gray-500">{transaction.displayDate}</p>
                                  </div>
                                </div>
                              </div>
                              
                              <div className="flex items-center space-x-3">
                                <span className={`font-bold text-lg ${
                                  transaction.type === 'income' ? 'text-green-600' : 'text-red-600'
                                }`}>
                                  {transaction.type === 'income' ? '+' : '-'}Â¥{transaction.amount.toLocaleString()}
                                </span>
                                
                                <button
                                  onClick={() => editTransaction(transaction)}
                                  className="text-blue-500 hover:text-blue-700 transition-colors"
                                  title="ç·¨é›†"
                                >
                                  <Edit className="h-4 w-4" />
                                </button>
                                
                                <button
                                  onClick={() => deleteTransaction(transaction.id)}
                                  className="text-red-500 hover:text-red-700 transition-colors"
                                  title="å‰Šé™¤"
                                >
                                  <Trash2 className="h-4 w-4" />
                                </button>
                              </div>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  </div>
                </>
              )}

              {/* æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿ã‚¿ãƒ– */}
              {activeTab === 'monthly' && (
                <>
                  {/* æœˆé¸æŠ */}
                  <div className="bg-white p-6 rounded-lg shadow-lg mb-8">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-xl font-semibold text-gray-700">æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿</h2>
                      <div className="flex items-center space-x-4">
                        <div className="flex items-center space-x-2">
                          <label className="text-sm font-medium text-gray-700">å¹´:</label>
                          <select
                            value={selectedMonth.slice(0, 4)}
                            onChange={(e) => setSelectedMonth(e.target.value + '-01')}
                            className="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            {[...Array(10)].map((_, i) => {
                              const year = new Date().getFullYear() - i;
                              return (
                                <option key={year} value={year}>{year}å¹´</option>
                              );
                            })}
                          </select>
                        </div>
                        <div className="flex items-center space-x-2">
                          <label className="text-sm font-medium text-gray-700">æœˆ:</label>
                          <select
                            value={selectedMonth.slice(5, 7)}
                            onChange={(e) => setSelectedMonth(selectedMonth.slice(0, 4) + '-' + e.target.value)}
                            className="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            {[...Array(12)].map((_, i) => {
                              const month = (i + 1).toString().padStart(2, '0');
                              const monthName = new Date(2024, i).toLocaleDateString('ja-JP', { month: 'long' });
                              return (
                                <option key={month} value={month}>{monthName}</option>
                              );
                            })}
                          </select>
                        </div>
                      </div>
                    </div>

                    {/* æœˆåˆ¥ã‚µãƒãƒªãƒ¼ */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-green-600 text-sm font-medium">æœˆé–“åå…¥</p>
                            <p className="text-xl font-bold text-green-700">Â¥{monthlyIncome.toLocaleString()}</p>
                          </div>
                          <TrendingUp className="h-6 w-6 text-green-600" />
                        </div>
                      </div>
                      
                      <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-red-600 text-sm font-medium">æœˆé–“æ”¯å‡º</p>
                            <p className="text-xl font-bold text-red-700">Â¥{monthlyExpense.toLocaleString()}</p>
                          </div>
                          <TrendingDown className="h-6 w-6 text-red-600" />
                        </div>
                      </div>
                      
                      <div className={`p-4 rounded-lg border ${
                        (monthlyIncome - monthlyExpense) >= 0 
                          ? 'bg-blue-50 border-blue-200' 
                          : 'bg-orange-50 border-orange-200'
                      }`}>
                        <div className="flex items-center justify-between">
                          <div>
                            <p className={`text-sm font-medium ${
                              (monthlyIncome - monthlyExpense) >= 0 ? 'text-blue-600' : 'text-orange-600'
                            }`}>æœˆé–“åæ”¯</p>
                            <p className={`text-xl font-bold ${
                              (monthlyIncome - monthlyExpense) >= 0 ? 'text-blue-700' : 'text-orange-700'
                            }`}>
                              Â¥{(monthlyIncome - monthlyExpense).toLocaleString()}
                            </p>
                          </div>
                          <BarChart3 className={`h-6 w-6 ${
                            (monthlyIncome - monthlyExpense) >= 0 ? 'text-blue-600' : 'text-orange-600'
                          }`} />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* é¸æŠæœˆã®å–å¼•ä¸€è¦§ */}
                  <div className="bg-white rounded-lg shadow-lg mb-8">
                    <div className="p-6 border-b border-gray-200">
                      <h2 className="text-xl font-semibold text-gray-700">
                        {new Date(selectedMonth + '-01').toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' })}ã®å–å¼•ä¸€è¦§
                      </h2>
                      <p className="text-sm text-gray-500 mt-1">å–å¼•ã‚’ç·¨é›†ãƒ»å‰Šé™¤ã§ãã¾ã™</p>
                    </div>
                    
                    <div className="max-h-96 overflow-y-auto">
                      {currentMonthData.length === 0 ? (
                        <div className="p-8 text-center text-gray-500">
                          <Calendar className="h-12 w-12 mx-auto mb-4 text-gray-300" />
                          <p>ã“ã®æœˆã¯å–å¼•ãŒã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                      ) : (
                        currentMonthData.map(transaction => (
                          <div key={transaction.id} className="p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors">
                            <div className="flex items-center justify-between">
                              <div className="flex-1">
                                <div className="flex items-center space-x-3">
                                  <div className={`w-3 h-3 rounded-full ${
                                    transaction.type === 'income' ? 'bg-green-500' : 'bg-red-500'
                                  }`}></div>
                                  <div>
                                    <p className="font-medium text-gray-800">{transaction.category}</p>
                                    {transaction.description && (
                                      <p className="text-sm text-gray-600">{transaction.description}</p>
                                    )}
                                    <p className="text-xs text-gray-500">{transaction.displayDate}</p>
                                  </div>
                                </div>
                              </div>
                              
                              <div className="flex items-center space-x-3">
                                <span className={`font-bold text-lg ${
                                  transaction.type === 'income' ? 'text-green-600' : 'text-red-600'
                                }`}>
                                  {transaction.type === 'income' ? '+' : '-'}Â¥{transaction.amount.toLocaleString()}
                                </span>
                                
                                <button
                                  onClick={() => editTransaction(transaction)}
                                  className="text-blue-500 hover:text-blue-700 transition-colors"
                                  title="ç·¨é›†"
                                >
                                  <Edit className="h-4 w-4" />
                                </button>
                                
                                <button
                                  onClick={() => {
                                    if (confirm('ã“ã®å–å¼•ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                                      deleteTransaction(transaction.id);
                                    }
                                  }}
                                  className="text-red-500 hover:text-red-700 transition-colors"
                                  title="å‰Šé™¤"
                                >
                                  <Trash2 className="h-4 w-4" />
                                </button>
                              </div>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  </div>

                  {/* æœˆåˆ¥å±¥æ­´ */}
                  <div className="bg-white rounded-lg shadow-lg">
                    <div className="p-6 border-b border-gray-200">
                      <h2 className="text-xl font-semibold text-gray-700">æœˆåˆ¥å±¥æ­´</h2>
                    </div>
                    
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æœˆ</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åå…¥</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ”¯å‡º</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åæ”¯</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {monthlyHistory.map(month => (
                            <tr key={month.month} className="hover:bg-gray-50">
                              <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                {new Date(month.month + '-01').toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' })}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold">
                                Â¥{month.income.toLocaleString()}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold">
                                Â¥{month.expense.toLocaleString()}
                              </td>
                              <td className={`px-6 py-4 whitespace-nowrap text-sm font-semibold ${
                                month.balance >= 0 ? 'text-blue-600' : 'text-orange-600'
                              }`}>
                                Â¥{month.balance.toLocaleString()}
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </>
              )}

              {/* å¹´åˆ¥ãƒ‡ãƒ¼ã‚¿ã‚¿ãƒ– */}
              {activeTab === 'yearly' && (
                <>
                  {/* å¹´é¸æŠ */}
                  <div className="bg-white p-6 rounded-lg shadow-lg mb-8">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-xl font-semibold text-gray-700 flex items-center">
                        <CalendarDays className="h-6 w-6 mr-2" />
                        å¹´åˆ¥ãƒ‡ãƒ¼ã‚¿
                      </h2>
                      <div className="flex items-center space-x-2">
                        <label className="text-sm font-medium text-gray-700">å¹´ã‚’é¸æŠ:</label>
                        <select
                          value={selectedYear}
                          onChange={(e) => setSelectedYear(e.target.value)}
                          className="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        >
                          {[...Array(10)].map((_, i) => {
                            const year = new Date().getFullYear() - i;
                            return (
                              <option key={year} value={year}>{year}å¹´</option>
                            );
                          })}
                        </select>
                      </div>
                    </div>

                    {/* å¹´åˆ¥ã‚µãƒãƒªãƒ¼ */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-green-600 text-sm font-medium">å¹´é–“åå…¥</p>
                            <p className="text-xl font-bold text-green-700">Â¥{yearlyIncome.toLocaleString()}</p>
                          </div>
                          <TrendingUp className="h-6 w-6 text-green-600" />
                        </div>
                      </div>
                      
                      <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-red-600 text-sm font-medium">å¹´é–“æ”¯å‡º</p>
                            <p className="text-xl font-bold text-red-700">Â¥{yearlyExpense.toLocaleString()}</p>
                          </div>
                          <TrendingDown className="h-6 w-6 text-red-600" />
                        </div>
                      </div>
                      
                      <div className={`p-4 rounded-lg border ${
                        (yearlyIncome - yearlyExpense) >= 0 
                          ? 'bg-blue-50 border-blue-200' 
                          : 'bg-orange-50 border-orange-200'
                      }`}>
                        <div className="flex items-center justify-between">
                          <div>
                            <p className={`text-sm font-medium ${
                              (yearlyIncome - yearlyExpense) >= 0 ? 'text-blue-600' : 'text-orange-600'
                            }`}>å¹´é–“åæ”¯</p>
                            <p className={`text-xl font-bold ${
                              (yearlyIncome - yearlyExpense) >= 0 ? 'text-blue-700' : 'text-orange-700'
                            }`}>
                              Â¥{(yearlyIncome - yearlyExpense).toLocaleString()}
                            </p>
                          </div>
                          <BarChart3 className={`h-6 w-6 ${
                            (yearlyIncome - yearlyExpense) >= 0 ? 'text-blue-600' : 'text-orange-600'
                          }`} />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* å¹´é–“æœˆåˆ¥å†…è¨³ */}
                  <div className="bg-white rounded-lg shadow-lg mb-8">
                    <div className="p-6 border-b border-gray-200">
                      <h2 className="text-xl font-semibold text-gray-700">{selectedYear}å¹´ æœˆåˆ¥å†…è¨³</h2>
                    </div>
                    
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æœˆ</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åå…¥</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ”¯å‡º</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åæ”¯</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {yearlyMonthlyBreakdown.map(month => (
                            <tr key={month.month} className="hover:bg-gray-50">
                              <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                {month.monthName}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold">
                                Â¥{month.income.toLocaleString()}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold">
                                Â¥{month.expense.toLocaleString()}
                              </td>
                              <td className={`px-6 py-4 whitespace-nowrap text-sm font-semibold ${
                                month.balance >= 0 ? 'text-blue-600' : 'text-orange-600'
                              }`}>
                                Â¥{month.balance.toLocaleString()}
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>

                  {/* å¹´åˆ¥å±¥æ­´ */}
                  <div className="bg-white rounded-lg shadow-lg">
                    <div className="p-6 border-b border-gray-200">
                      <h2 className="text-xl font-semibold text-gray-700">å¹´åˆ¥å±¥æ­´</h2>
                    </div>
                    
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¹´</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åå…¥</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ”¯å‡º</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åæ”¯</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {yearlyHistory.map(year => (
                            <tr key={year.year} className="hover:bg-gray-50">
                              <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                {year.year}å¹´
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semib<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒª - Family Budget App</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {}
            }
        }
    </script>
    <style>
        /* ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        .max-w-6xl { max-width: 72rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .p-6 { padding: 1.5rem; }
        .bg-gradient-to-br { background: linear-gradient(to bottom right, #dbeafe, #e0e7ff); }
        .min-h-screen { min-height: 100vh; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .font-bold { font-weight: 700; }
        .text-center { text-align: center; }
        .mb-8 { margin-bottom: 2rem; }
        .text-gray-800 { color: #1f2937; }
        .bg-white { background-color: #ffffff; }
        .rounded-lg { border-radius: 0.5rem; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .gap-4 { gap: 1rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .bg-blue-500 { background-color: #3b82f6; }
        .text-white { color: #ffffff; }
        .rounded-md { border-radius: 0.375rem; }
        .transition-colors { transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out; }
        .hover\:bg-blue-600:hover { background-color: #2563eb; }
        .hover\:bg-gray-100:hover { background-color: #f3f4f6; }
        .text-gray-700 { color: #374151; }
        .bg-green-100 { background-color: #dcfce7; }
        .bg-red-100 { background-color: #fee2e2; }
        .bg-blue-100 { background-color: #dbeafe; }
        .bg-orange-100 { background-color: #fed7aa; }
        .text-green-600 { color: #16a34a; }
        .text-green-700 { color: #15803d; }
        .text-red-600 { color: #dc2626; }
        .text-red-700 { color: #b91c1c; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-700 { color: #1d4ed8; }
        .text-orange-600 { color: #ea580c; }
        .text-orange-700 { color: #c2410c; }
        .space-x-1 > * + * { margin-left: 0.25rem; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
        .space-x-4 > * + * { margin-left: 1rem; }
        .w-full { width: 100%; }
        .border { border-width: 1px; }
        .border-gray-300 { border-color: #d1d5db; }
        .focus\:ring-2:focus { box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); }
        .focus\:ring-blue-500:focus { box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); }
        .disabled\:bg-gray-400:disabled { background-color: #9ca3af; }
        .disabled\:cursor-not-allowed:disabled { cursor: not-allowed; }
        
        @media (min-width: 768px) {
            .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        
        @media (min-width: 1024px) {
            .lg\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { PlusCircle, MinusCircle, Trash2, Calendar, DollarSign, TrendingUp, TrendingDown, BarChart3, PieChart, CalendarDays, Download, Upload, Share2, Copy, Edit, X, Check } = lucide;

        const HouseholdBudgetApp = () => {
          const [transactions, setTransactions] = useState([]);
          const [amount, setAmount] = useState('');
          const [category, setCategory] = useState('');
          const [description, setDescription] = useState('');
          const [type, setType] = useState('expense');
          const [filter, setFilter] = useState('all');
          const [activeTab, setActiveTab] = useState('dashboard');
          const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));
          const [selectedYear, setSelectedYear] = useState(new Date().getFullYear().toString());
          const [shareUrl, setShareUrl] = useState('');
          const [showCopyMessage, setShowCopyMessage] = useState(false);
          
          // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç”¨ã®æœŸé–“è¨­å®š
          const [exportPeriod, setExportPeriod] = useState('all');
          const [exportStartDate, setExportStartDate] = useState('');
          const [exportEndDate, setExportEndDate] = useState('');
          
          // ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ­£ç¢ºã«å–å¾—
          const getTodayString = () => {
            const today = new Date();
            return today.getFullYear() + '-' + 
                   String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                   String(today.getDate()).padStart(2, '0');
          };
          
          const [transactionDate, setTransactionDate] = useState(getTodayString());
          const [editingTransaction, setEditingTransaction] = useState(null);

          // localStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
          useEffect(() => {
            try {
              const savedTransactions = localStorage.getItem('household_transactions');
              if (savedTransactions) {
                const parsedTransactions = JSON.parse(savedTransactions);
                setTransactions(parsedTransactions);
              }
            } catch (error) {
              console.error('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
          }, []);

          // ãƒ‡ãƒ¼ã‚¿ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«localStorageã«è‡ªå‹•ä¿å­˜
          useEffect(() => {
            try {
              localStorage.setItem('household_transactions', JSON.stringify(transactions));
            } catch (error) {
              console.error('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
          }, [transactions]);

          // ã‚«ãƒ†ã‚´ãƒªã®é¸æŠè‚¢ã¨èª¬æ˜
          const expenseCategories = {
            'å›ºå®šè²»': [
              { name: 'ä½å±…è²»', description: 'å®¶è³ƒã€ä½å®…ãƒ­ãƒ¼ãƒ³ã€é§è»Šå ´ä»£ãªã©ã®æ”¯å‡ºé …ç›®' },
              { name: 'æ°´é“å…‰ç†±è²»', description: 'æ°´é“ä»£ã€é›»æ°—ä»£ã€ã‚¬ã‚¹ä»£ãªã©ã®æ”¯å‡ºé …ç›®' },
              { name: 'é€šä¿¡è²»', description: 'ã‚¹ãƒãƒ›æ–™é‡‘ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ–™é‡‘ã€å®…é…ä¾¿æ–™é‡‘ãªã©ã®æ”¯å‡ºé …ç›®' },
              { name: 'ä¿é™ºæ–™', description: 'ç”Ÿå‘½ä¿é™ºã‚„åŒ»ç™‚ä¿é™ºã€ä»‹è­·ä¿é™ºãªã©ã®æ”¯å‡ºé …ç›®' }
            ],
            'å¤‰å‹•è²»': [
              { name: 'é£Ÿè²»', description: 'å¤–é£Ÿè²»ã‚„é£Ÿæè³¼å…¥è²»ã€é…’ä»£ãªã©é£²é£Ÿã«é–¢ã‚ã‚‹æ”¯å‡ºé …ç›®' },
              { name: 'æ—¥ç”¨å“è²»', description: 'æƒé™¤é“å…·ã‚„ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ã€ãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒšãƒ¼ãƒ‘ãƒ¼ãªã©æ—¥ç”¨å“ã®æ”¯å‡ºé …ç›®' },
              { name: 'è¢«æœè²»', description: 'æ´‹æœã‚„é´ã€ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ãªã©ã®æ”¯å‡ºé …ç›®' },
              { name: 'ç¾å®¹è²»', description: 'åŒ–ç²§å“ã‚„ã‚¨ã‚¹ãƒ†ãªã©ã®æ”¯å‡ºé …ç›®' },
              { name: 'äº¤éš›è²»', description: 'ãƒ‡ãƒ¼ãƒˆã‚„é£²ã¿ä¼šã€å‹äººãƒ»çŸ¥äººã¸ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆãªã©ã®æ”¯å‡ºé …ç›®' },
              { name: 'è¶£å‘³è²»', description: 'æ›¸ç±ä»£ã‚„æ˜ ç”»ãƒã‚±ãƒƒãƒˆä»£ãªã©è¶£å‘³ã«é–¢ã™ã‚‹æ”¯å‡ºé …ç›®' },
              { name: 'äº¤é€šè²»', description: 'é›»è»Šã‚„ãƒã‚¹ã®é‹è³ƒã€ã‚¬ã‚½ãƒªãƒ³ä»£ãªã©ã®æ”¯å‡ºé …ç›®' },
              { name: 'æ•™è‚²è²»', description: 'å­ã©ã‚‚ã®å­¦è²»ã‚„æ•™æã®è³¼å…¥è²»ãªã©ã®æ”¯å‡ºé …ç›®' },
              { name: 'åŒ»ç™‚è²»', description: 'é€šé™¢è²»ã‚„å…¥é™¢è²»ã€åŒ»è–¬å“ã®è³¼å…¥è²»ãªã©ã®æ”¯å‡ºé …ç›®' },
              { name: 'ç‰¹åˆ¥è²»', description: 'ã‚¤ãƒ™ãƒ³ãƒˆãªã©ã€æ¯æœˆç™ºç”Ÿã—ãªã„æ”¯å‡ºã®é …ç›®' },
              { name: 'é›‘è²»', description: 'ä¸Šè¨˜ä»¥å¤–ã€ç”¨é€”ä¸æ˜ã®æ”¯å‡ºé …ç›®' }
            ]
          };
          const incomeCategories = ['çµ¦ä¸', 'ãƒœãƒ¼ãƒŠã‚¹', 'å‰¯æ¥­', 'ãã®ä»–'];

          // é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã®èª¬æ˜ã‚’å–å¾—
          const getCategoryDescription = (categoryName) => {
            if (!categoryName || type === 'income') return '';
            
            for (const group of Object.values(expenseCategories)) {
              const found = group.find(item => item.name === categoryName);
              if (found) return found.description;
            }
            return '';
          };

          // URLã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ï¼ˆå…±æœ‰URLæ©Ÿèƒ½ï¼‰
          useEffect(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const sharedData = urlParams.get('data');
            if (sharedData) {
              try {
                const decodedData = JSON.parse(atob(sharedData));
                setTransactions(decodedData);
                localStorage.setItem('household_transactions', JSON.stringify(decodedData));
              } catch (error) {
                console.error('å…±æœ‰ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
              }
            }
          }, []);

          // æœŸé–“ã«åŸºã¥ã„ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
          const getFilteredTransactions = () => {
            if (exportPeriod === 'all') {
              return transactions;
            }
            
            const today = new Date();
            let startDate, endDate;
            
            switch (exportPeriod) {
              case 'current-month':
                startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                break;
              case 'current-year':
                startDate = new Date(today.getFullYear(), 0, 1);
                endDate = new Date(today.getFullYear(), 11, 31);
                break;
              case 'custom':
                if (!exportStartDate || !exportEndDate) return [];
                startDate = new Date(exportStartDate);
                endDate = new Date(exportEndDate);
                break;
              default:
                return transactions;
            }
            
            const startDateStr = startDate.toISOString().split('T')[0];
            const endDateStr = endDate.toISOString().split('T')[0];
            
            return transactions.filter(transaction => {
              return transaction.date >= startDateStr && transaction.date <= endDateStr;
            });
          };

          // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆJSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
          const exportData = () => {
            const filteredTransactions = getFilteredTransactions();
            const dataToExport = {
              transactions: filteredTransactions,
              exportDate: new Date().toISOString(),
              period: exportPeriod,
              startDate: exportPeriod === 'custom' ? exportStartDate : null,
              endDate: exportPeriod === 'custom' ? exportEndDate : null,
              version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], {
              type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            
            const today = new Date();
            let filename = 'å®¶è¨ˆç°¿ãƒ‡ãƒ¼ã‚¿';
            if (exportPeriod === 'current-month') {
              filename += `_${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ`;
            } else if (exportPeriod === 'current-year') {
              filename += `_${today.getFullYear()}å¹´`;
            } else if (exportPeriod === 'custom' && exportStartDate && exportEndDate) {
              filename += `_${exportStartDate}_${exportEndDate}`;
            } else {
              filename += `_å…¨æœŸé–“`;
            }
            filename += `_${new Date().toLocaleDateString('ja-JP').replace(/\//g, '-')}.json`;
            
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          };

          // ãƒ‡ãƒ¼ã‚¿ã‚’CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          const exportCSV = () => {
            const filteredTransactions = getFilteredTransactions();
            const headers = ['æ—¥ä»˜', 'ç¨®é¡', 'ã‚«ãƒ†ã‚´ãƒª', 'é‡‘é¡', 'èª¬æ˜'];
            const csvData = [headers];
            
            const sortedTransactions = [...filteredTransactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedTransactions.forEach(transaction => {
              csvData.push([
                transaction.date,
                transaction.type === 'income' ? 'åå…¥' : 'æ”¯å‡º',
                transaction.category,
                transaction.amount,
                transaction.description || ''
              ]);
            });
            
            const csvString = '\uFEFF' + csvData.map(row => 
              row.map(cell => {
                if (typeof cell === 'string' && (cell.includes(',') || cell.includes('"') || cell.includes('\n'))) {
                  return `"${cell.replace(/"/g, '""')}"`;
                }
                return cell;
              }).join(',')
            ).join('\n');
            
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            
            const today = new Date();
            let filename = 'å®¶è¨ˆç°¿ãƒ‡ãƒ¼ã‚¿';
            if (exportPeriod === 'current-month') {
              filename += `_${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ`;
            } else if (exportPeriod === 'current-year') {
              filename += `_${today.getFullYear()}å¹´`;
            } else if (exportPeriod === 'custom' && exportStartDate && exportEndDate) {
              filename += `_${exportStartDate}_${exportEndDate}`;
            } else {
              filename += `_å…¨æœŸé–“`;
            }
            filename += `_${new Date().toLocaleDateString('ja-JP').replace(/\//g, '-')}.csv`;
            
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          };

          // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
          const importData = (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const content = e.target.result;
                
                if (file.name.endsWith('.csv')) {
                  const lines = content.split('\n');
                  const headers = lines[0].split(',');
                  
                  const expectedHeaders = ['æ—¥ä»˜', 'ç¨®é¡', 'ã‚«ãƒ†ã‚´ãƒª', 'é‡‘é¡', 'èª¬æ˜'];
                  const isValidCSV = expectedHeaders.every(header => 
                    headers.some(h => h.trim().replace(/"/g, '') === header)
                  );
                  
                  if (!isValidCSV) {
                    alert('ç„¡åŠ¹ãªCSVãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚æ­£ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚');
                    return;
                  }
                  
                  const importedTransactions = [];
                  for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    const values = line.split(',').map(v => v.trim().replace(/^"|"$/g, ''));
                    
                    if (values.length >= 4) {
                      const transaction = {
                        id: Date.now() + i,
                        date: values[0],
                        type: values[1] === 'åå…¥' ? 'income' : 'expense',
                        category: values[2],
                        amount: parseFloat(values[3]) || 0,
                        description: values[4] || '',
                        displayDate: new Date(values[0]).toLocaleDateString('ja-JP')
                      };
                      importedTransactions.push(transaction);
                    }
                  }
                  
                  if (importedTransactions.length > 0) {
                    setTransactions(importedTransactions);
                    localStorage.setItem('household_transactions', JSON.stringify(importedTransactions));
                    alert(`${importedTransactions.length}ä»¶ã®å–å¼•ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼`);
                  } else {
                    alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
                  }
                } else {
                  const importedData = JSON.parse(content);
                  if (importedData.transactions && Array.isArray(importedData.transactions)) {
                    setTransactions(importedData.transactions);
                    localStorage.setItem('household_transactions', JSON.stringify(importedData.transactions));
                    alert('ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                  } else {
                    alert('ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚');
                  }
                }
              } catch (error) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                console.error('Import error:', error);
              }
            };
            reader.readAsText(file);
          };

          // å…±æœ‰URLã‚’ç”Ÿæˆ
          const generateShareUrl = () => {
            const encodedData = btoa(JSON.stringify(transactions));
            const baseUrl = window.location.origin + window.location.pathname;
            const url = `${baseUrl}?data=${encodedData}`;
            setShareUrl(url);
            return url;
          };

          // URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
          const copyToClipboard = async () => {
            try {
              const url = shareUrl || generateShareUrl();
              await navigator.clipboard.writeText(url);
              setShowCopyMessage(true);
              setTimeout(() => setShowCopyMessage(false), 2000);
            } catch (error) {
              const textArea = document.createElement('textarea');
              textArea.value = shareUrl || generateShareUrl();
              document.body.appendChild(textArea);
              textArea.select();
              document.execCommand('copy');
              document.body.removeChild(textArea);
              setShowCopyMessage(true);
              setTimeout(() => setShowCopyMessage(false), 2000);
            }
          };

          // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
          const clearAllData = () => {
            if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
              setTransactions([]);
              setShareUrl('');
              localStorage.removeItem('household_transactions');
              alert('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
            }
          };

          // å–å¼•ã‚’è¿½åŠ 
          const addTransaction = () => {
            if (!amount || !category) return;
            
            const newTransaction = {
              id: Date.now(),
              amount: parseFloat(amount),
              category,
              description,
              type,
              date: transactionDate,
              displayDate: new Date(transactionDate).toLocaleDateString('ja-JP')
            };
            
            setTransactions([newTransaction, ...transactions]);
            setAmount('');
            setCategory('');
            setDescription('');
          };

          // å–å¼•ã‚’ç·¨é›†
          const editTransaction = (transaction) => {
            setEditingTransaction(transaction);
            setAmount(transaction.amount.toString());
            setCategory(transaction.category);
            setDescription(transaction.description);
            setType(transaction.type);
            setTransactionDate(transaction.date);
          };

          // ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
          const cancelEdit = () => {
            setEditingTransaction(null);
            setAmount('');
            setCategory('');
            setDescription('');
            setType('expense');
            setTransactionDate(getTodayString());
          };

          // ç·¨é›†ã‚’ä¿å­˜
          const saveEdit = () => {
            if (!amount || !category) return;
            
            const updatedTransaction = {
              ...editingTransaction,
              amount: parseFloat(amount),
              category,
              description,
              type,
              date: transactionDate,
              displayDate: new Date(transactionDate).toLocaleDateString('ja-JP')
            };
            
            setTransactions(transactions.map(t => 
              t.id === editingTransaction.id ? updatedTransaction : t
            ));
            
            cancelEdit();
          };

          // å–å¼•ã‚’å‰Šé™¤
          const deleteTransaction = (id) => {
            setTransactions(transactions.filter(t => t.id !== id));
          };

          // æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
          const getMonthlyData = (month) => {
            return transactions.filter(t => t.date.startsWith(month));
          };

          // å¹´åˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
          const getYearlyData = (year) => {
            return transactions.filter(t => t.date.startsWith(year));
          };

          // å½“æ—¥ã®å–å¼•ã®ã¿ã‚’å–å¾—ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ï¼‰
          const todaysTransactions = transactions.filter(t => {
            const today = new Date();
            const todayString = today.getFullYear() + '-' + 
                               String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                               String(today.getDate()).padStart(2, '0');
            
            const matchesDate = t.date === todayString;
            const matchesFilter = filter === 'all' || t.type === filter;
            return matchesDate && matchesFilter;
          });

          // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸå–å¼•
          const filteredTransactions = transactions.filter(t => 
            filter === 'all' || t.type === filter
          );

          // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹æœˆã®ãƒ‡ãƒ¼ã‚¿
          const currentMonthData = getMonthlyData(selectedMonth);
          
          // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹å¹´ã®ãƒ‡ãƒ¼ã‚¿
          const currentYearData = getYearlyData(selectedYear);
          
          // å…¨ä½“ã®åˆè¨ˆ
          const totalIncome = transactions
            .filter(t => t.type === 'income')
            .reduce((sum, t) => sum + t.amount, 0);
          
          const totalExpense = transactions
            .filter(t => t.type === 'expense')
            .reduce((sum, t) => sum + t.amount, 0);
          
          const balance = totalIncome - totalExpense;

          // æœˆåˆ¥åˆè¨ˆ
          const monthlyIncome = currentMonthData
            .filter(t => t.type === 'income')
            .reduce((sum, t) => sum + t.amount, 0);
          
          const monthlyExpense = currentMonthData
            .filter(t => t.type === 'expense')
            .reduce((sum, t) => sum + t.amount, 0);

          // å¹´åˆ¥åˆè¨ˆ
          const yearlyIncome = currentYearData
            .filter(t => t.type === 'income')
            .reduce((sum, t) => sum + t.amount, 0);
          
          const yearlyExpense = currentYearData
            .filter(t => t.type === 'expense')
            .reduce((sum, t) => sum + t.amount, 0);

          // ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡ºåˆ†æ
          const getCategoryAnalysis = (data) => {
            const expenseData = data.filter(t => t.type === 'expense');
            const categoryTotals = {};
            
            expenseData.forEach(t => {
              categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });
            
            const totalExpenseAmount = Object.values(categoryTotals).reduce((sum, amount) => sum + amount, 0);
            
            return Object.entries(categoryTotals)
              .map(([category, amount]) => ({
                category,
                amount,
                percentage: totalExpenseAmount > 0 ? (amount / totalExpenseAmount * 100).toFixed(1) : 0
              }))
              .sort((a, b) => b.amount - a.amount);
          };

          // æœˆåˆ¥å±¥æ­´ã‚’ç”Ÿæˆ
          const getMonthlyHistory = () => {
            const monthlyData = {};
            transactions.forEach(t => {
              const month = t.date.slice(0, 7);
              if (!monthlyData[month]) {
                monthlyData[month] = { income: 0, expense: 0 };
              }
              monthlyData[month][t.type] += t.amount;
            });
            
            return Object.entries(monthlyData)
              .map(([month, data]) => ({
                month,
                income: data.income,
                expense: data.expense,
                balance: data.income - data.expense
              }))
              .sort((a, b) => b.month.localeCompare(a.month));
          };

          // å¹´åˆ¥å±¥æ­´ã‚’ç”Ÿæˆ
          const getYearlyHistory = () => {
            const yearlyData = {};
            transactions.forEach(t => {
              const year = t.date.slice(0, 4);
              if (!yearlyData[year]) {
                yearlyData[year] = { income: 0, expense: 0 };
              }
              yearlyData[year][t.type] += t.amount;
            });
            
            return Object.entries(yearlyData)
              .map(([year, data]) => ({
                year,
                income: data.income,
                expense: data.expense,
                balance: data.income - data.expense
              }))
              .sort((a, b) => b.year.localeCompare(a.year));
          };

          // å¹´é–“æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
          const getYearlyMonthlyBreakdown = (year) => {
            const monthlyBreakdown = [];
            for (let i = 1; i <= 12; i++) {
              const monthStr = `${year}-${i.toString().padStart(2, '0')}`;
              const monthData = getMonthlyData(monthStr);
              const income = monthData.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
              const expense = monthData.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
              
              monthlyBreakdown.push({
                month: i,
                monthStr,
                monthName: new Date(year, i - 1).toLocaleDateString('ja-JP', { month: 'long' }),
                income,
                expense,
                balance: income - expense
              });
            }
            return monthlyBreakdown;
          };

          const monthlyHistory = getMonthlyHistory();
          const yearlyHistory = getYearlyHistory();
          const categoryAnalysis = getCategoryAnalysis(currentMonthData);
          const yearlyCategoryAnalysis = getCategoryAnalysis(currentYearData);
          const yearlyMonthlyBreakdown = getYearlyMonthlyBreakdown(selectedYear);

          return (
            <div className="max-w-6xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
              <h1 className="text-3xl font-bold text-center mb-8 text-gray-800">å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒª</h1>
              
              {/* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */}
              <div className="flex space-x-1 mb-8 bg-white p-1 rounded-lg shadow-md overflow-x-auto">
                <button
                  onClick={() => setActiveTab('dashboard')}
                  className={`flex-shrink-0 py-3 px-4 rounded-md font-medium transition-colors ${
                    activeTab === 'dashboard' ? 'bg-blue-500 text-white' : 'text-gray-700 hover:bg-gray-100'
                  }`}
                >
                  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                </button>
                <button
                  onClick={() => setActiveTab('monthly')}
                  className={`flex-shrink-0 py-3 px-4 rounded-md font-medium transition-colors ${
                    activeTab === 'monthly' ? 'bg-blue-500 text-white' : 'text-gray-700 hover:bg-gray-100'
                  }`}
                >
                  æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿
                </button>
                <button
                  onClick={() => setActiveTab('yearly')}
                  className={`flex-shrink-0 py-3 px-4 rounded-md font-medium transition-colors ${
                    activeTab === 'yearly' ? 'bg-blue-500 text-white' : 'text-gray-700 hover:bg-gray-100'
                  }`}
                >
                  å¹´åˆ¥ãƒ‡ãƒ¼ã‚¿
                </button>
                <button
                  onClick={() => setActiveTab('analysis')}
                  className={`flex-shrink-0 py-3 px-4 rounded-md font-medium transition-colors ${
                    activeTab === 'analysis' ? 'bg-blue-500 text-white' : 'text-gray-700 hover:bg-gray-100'
                  }`}
                >
                  æ”¯å‡ºåˆ†æ
                </button>
                <button
                  onClick={() => setActiveTab('backup')}
                  className={`flex-shrink-0 py-3 px-4 rounded-md font-medium transition-colors ${
                    activeTab === 'backup' ? 'bg-blue-500 text-white' : 'text-gray-700 hover:bg-gray-100'
                  }`}
                >
                  å…±æœ‰ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
                </button>
              </div>

              {/* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ– */}
              {activeTab === 'dashboard' && (
                <>
                  {/* ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ */}
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div className="bg-green-100 p-4 rounded-lg shadow-md">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-green-600 text-sm font-medium">ç·åå…¥</p>
                          <p className="text-2xl font-bold text-green-700">Â¥{totalIncome.toLocaleString()}</p>
                        </div>
                        <TrendingUp className="h-8 w-8 text-green-600" />
                      </div>
                    </div>
                    
                    <div className="bg-red-100 p-4 rounded-lg shadow-md">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-red-600 text-sm font-medium">ç·æ”¯å‡º</p>
                          <p className="text-2xl font-bold text-red-700">Â¥{totalExpense.toLocaleString()}</p>
                        </div>
                        <TrendingDown className="h-8 w-8 text-red-600" />
                      </div>
                    </div>
                    
                    <div className={`p-4 rounded-lg shadow-md ${balance >= 0 ? 'bg-blue-100' : 'bg-orange-100'}`}>
                      <div className="flex items-center justify-between">
                        <div>
                          <p className={`text-sm font-medium ${balance >= 0 ? 'text-blue-600' : 'text-orange-600'}`}>æ®‹é«˜</p>
                          <p className={`text-2xl font-bold ${balance >= 0 ? 'text-blue-700' : 'text-orange-700'}`}>
                            Â¥{balance.toLocaleString()}
                          </p>
                        </div>
                        <DollarSign className={`h-8 w-8 ${balance >= 0 ? 'text-blue-600' : 'text-orange-600'}`} />
                      </div>
                    </div>
                  </div>

                  {/* è‡ªå‹•ä¿å­˜é€šçŸ¥ */}
                  {transactions.length > 0 && (
                    <div className="bg-green-50 border border-green-200 rounded-lg p-3 mb-6">
                      <div className="flex items-center">
                        <div className="flex-shrink-0">
                          <Check className="h-5 w-5 text-green-600" />
                        </div>
                        <div className="ml-3">
